<!DOCTYPE html>
<html lang="pt-BR" itemscope itemtype="https://schema.org/LocalBusiness">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cesta EconÃ´mica | Super Cestas Dona AntÃ´nia - CuiabÃ¡ e VG</title>
    <meta name="description" content="Encomende cestas bÃ¡sicas em CuiabÃ¡ e VÃ¡rzea Grande. Qualidade, preÃ§o justo e entrega rÃ¡pida. Fale com o Osvaldo!">
    <meta name="theme-color" content="#008069">
    
    <!-- PILLAR 1: SCHEMA MARKUP -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "GroceryStore",
      "name": "Super Cestas Dona AntÃ´nia",
      "image": "https://donaantonia.com.br/img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif",
      "telephone": "+5565998150975",
      "url": "https://donaantonia.com.br",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "CuiabÃ¡",
        "addressRegion": "MT",
        "addressCountry": "BR"
      },
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": -15.6014, 
        "longitude": -56.0979
      },
      "priceRange": "$$"
    }
    </script>

    <!-- FONTS & ICONS (Essenciais e leves) -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- PILLAR 3: SECURITY HEADERS -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https: data: blob:;">
    <meta http-equiv="X-Frame-Options" content="DENY">

    <style>
        /* === CSS NATIVO (BLINDADO CONTRA ERROS DE CARREGAMENTO) === */
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #E5DDD5;
            overflow: hidden; /* Evita scroll na pÃ¡gina inteira, apenas no chat */
            display: flex;
            flex-direction: column;
        }

        /* HEADER */
        .wa-header {
            background-color: #008069;
            color: white;
            height: 60px;
            padding: 0 10px;
            display: flex;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            z-index: 100;
            flex-shrink: 0;
        }

        .header-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            position: relative;
            background: #ccc;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .header-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .header-status-dot {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 12px;
            height: 12px;
            background-color: #4ade80; /* Green */
            border: 2px solid white;
            border-radius: 50%;
        }

        .header-info {
            flex: 1;
            overflow: hidden;
        }

        .header-title {
            font-weight: bold;
            font-size: 17px;
            line-height: 1.2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .header-subtitle {
            font-size: 12px;
            color: rgba(255,255,255,0.85);
        }

        .header-actions {
            display: flex;
            gap: 15px;
            font-size: 20px;
        }
        .header-actions a { color: white; text-decoration: none; }

        /* CHAT AREA */
        #chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background-color: #E5DDD5;
            background-image: url("data:image/svg+xml,%3Csvg width='320' height='180' viewBox='0 0 320 180' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%239CAFA3' fill-opacity='0.20' fill-rule='evenodd'%3E%3Ctext x='20' y='70' font-family='Arial, sans-serif' font-size='24' font-weight='bold' transform='rotate(-8 20 70)'%3Ewww.donaantonia.com.br%3C/text%3E%3Ctext x='80' y='150' font-family='Arial, sans-serif' font-size='24' font-weight='bold' transform='rotate(-8 80 150)'%3E65 99815-0975%3C/text%3E%3C/g%3E%3C/svg%3E");
            -webkit-overflow-scrolling: touch;
        }

        /* MENSAGENS */
        .msg-row {
            display: flex;
            width: 100%;
            margin-bottom: 8px;
            animation: fadeIn 0.3s ease;
        }
        .msg-start { justify-content: flex-start; }
        .msg-end { justify-content: flex-end; }

        .msg-bubble {
            padding: 8px 12px;
            border-radius: 7.5px;
            box-shadow: 0 1px 0.5px rgba(0,0,0,0.13);
            max-width: 85%;
            font-size: 15px;
            line-height: 19px;
            position: relative;
            color: #111b21;
        }

        .msg-in { background-color: #fff; border-top-left-radius: 0; }
        .msg-out { background-color: #d9fdd3; border-top-right-radius: 0; }

        .msg-time {
            float: right;
            font-size: 11px;
            color: #667781;
            margin-top: 5px;
            margin-left: 10px;
            display: flex;
            align-items: center;
        }

        /* FOOTER */
        #input-footer {
            background-color: #f0f2f5;
            padding: 8px 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
            padding-bottom: env(safe-area-inset-bottom, 10px); /* iPhone X+ fix */
        }

        .input-box {
            flex: 1;
            background: white;
            border-radius: 20px;
            padding: 9px 15px;
            display: flex;
            align-items: center;
            box-shadow: inset 0 0 0 1px #fff;
        }

        .input-box input {
            border: none;
            outline: none;
            width: 100%;
            font-size: 16px; /* Evita zoom no iPhone */
            background: transparent;
        }

        .send-btn {
            width: 45px;
            height: 45px;
            background-color: #008069;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            border: none;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        .send-btn:active { transform: scale(0.95); }

        /* BUTTONS OPTIONS */
        .msg-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 85%;
            margin-bottom: 10px;
        }
        .wa-btn {
            background: white;
            color: #008069;
            border: 1px solid #f0f0f0;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .wa-btn-subtitle {
            display: block;
            font-size: 11px;
            font-weight: 400;
            color: #54656f;
            margin-top: 2px;
        }

        /* CARD UNIFICADO & UTILS */
        .card-msg-container { width: 100%; max-width: 95%; margin-bottom: 5px; }
        
        .card-cesta-new {
            background: #fff; border-radius: 16px; border: 1px solid #e0e0e0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); overflow: hidden; display: flex; flex-direction: column;
            position: relative;
        }

        .card-top-row { display: flex; height: 180px; border-bottom: 1px solid #f5f5f5; }
        .card-img-area { flex: 1; padding: 10px; display: flex; align-items: center; justify-content: center; position: relative; }
        .card-img-large { width: 140px; height: 140px; object-fit: contain; }

        .card-chips-area {
            width: 90px; background: #f8f9fa; border-left: 1px solid #eee; padding: 8px 5px;
            display: flex; flex-direction: column; gap: 8px; overflow-y: auto; justify-content: center;
        }
        .chip-nav {
            font-size: 10px; padding: 5px 2px; border-radius: 4px; text-align: center; cursor: pointer;
            border: 1px solid #e0e0e0; background: white; color: #666; font-weight: bold;
            text-transform: uppercase;
        }
        .chip-nav.selected { background: #008069; color: white; border-color: #006d59; }

        .selo-destaque {
            position: absolute; top: 8px; left: 8px;
            background: #ffb300; color: #000; padding: 2px 6px; border-radius: 10px;
            font-weight: bold; font-size: 10px; text-transform: uppercase; z-index: 10;
        }

        /* SLIDER PRODUTOS */
        .product-slider-container { background: #f9fafb; padding: 8px 0; width: 100%; border-bottom: 1px solid #eee; position: relative; }
        .slider-wrapper { position: relative; }
        .product-slider { 
            display: flex; overflow-x: auto; gap: 6px; padding: 0 10px; 
            scroll-behavior: smooth; -webkit-overflow-scrolling: touch; 
        }
        .product-slider::-webkit-scrollbar { display: none; }
        
        .product-slide {
            flex: 0 0 90px;
            background: #fff; border: 1px solid #e5e7eb; border-radius: 6px; padding: 6px 4px;
            text-align: center;
            display: flex; flex-direction: column; align-items: center;
        }
        .product-slide img { width: 60px; height: 60px; object-fit: contain; margin-bottom: 4px; }
        .product-qty { font-size: 11px; font-weight: bold; color: #0d5f46; display: block; }
        .product-name { font-size: 10px; color: #666; line-height: 1.1; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        .slider-arrow-indicator {
            position: absolute; right: 5px; top: 50%; transform: translateY(-50%);
            background: rgba(255,255,255,0.9); border: 2px solid #25D366; border-radius: 50%;
            width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2); pointer-events: none;
            animation: bounceRight 1.5s infinite;
        }

        /* PREÃ‡OS */
        .card-price-display-only { padding: 8px 10px; background: #fff; }
        .price-item-row { display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 4px; color: #333; }
        .price-item-row strong { color: #d32f2f; }

        /* DISCOUNT */
        .discount-container { 
            background: #fff; border-radius: 8px; padding: 12px; border: 1px solid #e0e0e0; 
            text-align: center; margin-bottom: 10px;
        }
        .discount-box { background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 6px; padding: 10px; margin-bottom: 10px; }
        .discount-val { font-size: 28px; font-weight: bold; color: #166534; display: block; }
        .cta-btn {
            width: 100%; background: #008069; color: white; font-weight: bold; 
            padding: 12px; border: none; border-radius: 8px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 5px;
        }

        /* COMPANY CARD */
        .company-header { padding: 15px; display: flex; align-items: center; border-bottom: 1px solid #eee; gap: 10px; }
        .company-logo { width: 60px; height: 60px; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .company-stats-list { display: flex; flex-direction: column; gap: 6px; padding: 10px; }
        .stat-row { 
            display: flex; align-items: center; padding: 8px; border-radius: 6px; color: white; 
            font-size: 13px; font-weight: 500;
        }
        .social-btn {
            background: linear-gradient(to right, #a855f7, #ec4899);
            color: white; padding: 12px; border-radius: 50px; text-decoration: none;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            font-weight: bold; margin-bottom: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .group-btn {
            background: linear-gradient(to right, #eab308, #ca8a04);
            color: white; padding: 12px; border-radius: 50px; text-decoration: none;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* UTILS */
        .hidden { display: none; }
        .typing-dot { 
            width: 6px; height: 6px; background: #999; border-radius: 50%; 
            display: inline-block; animation: typing 1.4s infinite; margin: 0 2px; 
        }
        @keyframes typing { 0%,100%{transform:scale(0.8);opacity:0.5} 50%{transform:scale(1.2);opacity:1} }
        @keyframes fadeIn { from{opacity:0;transform:translateY(5px)} to{opacity:1;transform:translateY(0)} }
        @keyframes bounceRight { 0%,100%{transform:translate(0,-50%)} 50%{transform:translate(5px,-50%)} }

        .text-link { color: #008069; font-weight: bold; text-decoration: none; }
        .text-link:hover { text-decoration: underline; }

    </style>
</head>
<body>

    <!-- HEADER -->
    <header class="wa-header">
        <div class="header-avatar">
            <img src="img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif" onerror="this.src='https://api.dicebear.com/7.x/avataaars/svg?seed=Osvaldo&backgroundColor=c0aede'" alt="Osvaldo">
            <div class="header-status-dot"></div>
        </div>
        <div class="header-info">
            <div class="header-title">Cestas Dona AntÃ´nia</div>
            <div id="status-text" class="header-subtitle">Online</div>
        </div>
        <div class="header-actions">
            <a href="https://instagram.com" target="_blank"><i class="fa-brands fa-instagram"></i></a>
            <a href="https://wa.me/5565998150975" target="_blank"><i class="fa-brands fa-whatsapp"></i></a>
        </div>
    </header>

    <!-- CHAT AREA -->
    <main id="chat-container">
        <!-- JS injeta mensagens aqui -->
    </main>

    <!-- FOOTER -->
    <footer id="input-footer">
        <div class="input-box">
            <input type="text" id="user-input" placeholder="Digite seu nome..." autocomplete="off">
        </div>
        <button id="send-btn" class="send-btn">
            <i class="fa-solid fa-paper-plane"></i>
        </button>
    </footer>

    <script>
        // === LÃ“GICA DE NEGÃ“CIO ===
        // Sem dependÃªncias externas de UI para garantir velocidade

        // SEGURANÃ‡A BÃSICA
        if (window.location.hostname !== 'localhost' && !window.location.hostname.includes('donaantonia')) {
            // console.warn('Domain check skipped for demo');
        }

        window.dataLayer = window.dataLayer || [];
        function trackEvent(eventName, params = {}) {
            window.dataLayer.push({ 'event': eventName, ...params });
        }

        const CONFIG = {
            ownerName: "Osvaldo",
            whatsAppGroupLink: "https://chat.whatsapp.com/IOI3gSBLRVk4jGK2QMunp1",
            whatsAppNumber: "5565998150975",
            whatsAppSaveNumber: "5565998150965",
            instagramLink: "https://instagram.com/cestas.dona.antonia.cuiaba.vg"
        };

        const CESTAS = [
            {
                id: 'economica', nome: 'Cesta EconÃ´mica', destaque: 'Mais Vendida', desconto: 5, arrozQtd: 1, 
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-economica.avif',
                items: ['1 Arroz Koblenz 5kg', '1 AÃ§Ãºcar 2kg', '1 Ã“leo 900ml', '1 FeijÃ£o 1kg', '1 CafÃ© 250g', '1 MacarrÃ£o 500g', '1 Trigo 1kg', '1 Farinha Mandioca 1Kg', '1 Sal 1kg', '1 Molho Tomate', '1 Milho', '1 Bolacha', '1 Miojo', '1 Suco'],
                opcoes: [{ arroz: 'Valor Ãšnico', preco: '85,00' }]
            },
            {
                id: 'mini', nome: 'Cesta Mini', desconto: 10, arrozQtd: 1,
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-mini.avif',
                items: ['1 Arroz 5kg', '1 AÃ§Ãºcar 2kg', '2 Ã“leo', '2 FeijÃ£o', '1 CafÃ©', '1 MacarrÃ£o', '1 Sal', '1 Molho', '1 Milho', '1 Bolacha', '1 Miojo', '2 Suco', 'Itens de Limpeza BÃ¡sicos'],
                opcoes: [{ arroz: 'Tio Alvino', preco: '165,00' }, { arroz: 'Koblenz', preco: '170,00' }]
            },
            {
                id: 'pequena', nome: 'Cesta Pequena', desconto: 15, arrozQtd: 2,
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-pequena.avif',
                items: ['2 Arroz 5kg', '1 AÃ§Ãºcar', '2 Ã“leo', '2 FeijÃ£o', '1 CafÃ©', '12 Ovos', '1 Bolo', 'Itens Variados...'],
                opcoes: [{ arroz: 'Tio Alvino', preco: '215,00' }, { arroz: 'Koblenz', preco: '220,00' }]
            },
            {
                id: 'media', nome: 'Cesta MÃ©dia', desconto: 20, arrozQtd: 3,
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-media.avif',
                items: ['3 Arroz 5kg', '2 AÃ§Ãºcar', '3 Ã“leo', '3 FeijÃ£o', '1 CafÃ© 500g', '12 Ovos', 'Muitos itens...'],
                opcoes: [{ arroz: 'Tio Alvino', preco: '320,00' }, { arroz: 'Koblenz', preco: '325,00' }]
            },
            {
                id: 'grande', nome: 'Cesta Grande', desconto: 25, arrozQtd: 4,
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-grande.avif',
                items: ['4 Arroz 5kg', '3 AÃ§Ãºcar', '4 Ã“leo', '4 FeijÃ£o', '1 CafÃ© 500g', '12 Ovos', 'Completa...'],
                opcoes: [{ arroz: 'Tio Alvino', preco: '380,00' }, { arroz: 'Koblenz', preco: '390,00' }]
            }
        ];

        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const statusText = document.getElementById('status-text');
        const inputFooter = document.getElementById('input-footer');

        let state = { step: 0, userName: '', selectedDiscountId: null };

        function scrollToBottom() {
            chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
        }

        function addMessage(text, type = 'bot', delayOverride = null) {
            return new Promise(resolve => {
                const delay = delayOverride !== null ? delayOverride : (type === 'bot' ? 600 : 0);
                
                setTimeout(() => {
                    if (type === 'bot') {
                        statusText.innerText = 'Digitando...';
                        const id = 'typing-' + Date.now();
                        chatContainer.insertAdjacentHTML('beforeend', `
                            <div id="${id}" class="msg-row msg-start">
                                <div class="msg-bubble msg-in">
                                    <span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span>
                                </div>
                            </div>
                        `);
                        scrollToBottom();

                        setTimeout(() => {
                            const el = document.getElementById(id);
                            if(el) el.remove();
                            
                            const isCard = text.includes('card-cesta') || text.includes('discount-container');
                            const bubbleStyle = isCard ? 'padding:0; background:transparent; box-shadow:none; max-width:100%;' : '';

                            chatContainer.insertAdjacentHTML('beforeend', `
                                <div class="msg-row msg-start">
                                    <div class="msg-bubble msg-in" style="${bubbleStyle}">
                                        ${text}
                                        ${!isCard ? `<span class="msg-time">${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>` : ''}
                                    </div>
                                </div>
                            `);
                            statusText.innerText = 'Online';
                            scrollToBottom();
                            resolve();
                        }, type === 'bot' ? text.length * 10 + 400 : 0);
                    } else {
                        chatContainer.insertAdjacentHTML('beforeend', `
                            <div class="msg-row msg-end">
                                <div class="msg-bubble msg-out">
                                    ${text}
                                    <span class="msg-time">${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})} <i class="fa-solid fa-check-double" style="color:#53bdeb; margin-left:3px;"></i></span>
                                </div>
                            </div>
                        `);
                        scrollToBottom();
                        resolve();
                    }
                }, delay);
            });
        }

        function showOptions(opts) {
            setTimeout(() => {
                const id = 'opts-' + Date.now();
                const btns = opts.map(o => `
                    <button class="wa-btn" onclick="handleOpt('${o.val}', ${o.next}, '${id}', '${o.text}')">
                        ${o.text}
                        ${o.sub ? `<span class="wa-btn-subtitle">${o.sub}</span>` : ''}
                    </button>
                `).join('');
                
                chatContainer.insertAdjacentHTML('beforeend', `
                    <div id="${id}" class="msg-row msg-start">
                        <div class="msg-options">${btns}</div>
                    </div>
                `);
                scrollToBottom();
            }, 500);
        }

        window.handleOpt = async function(val, next, id, text) {
            document.getElementById(id).remove();
            await addMessage(text, 'user');
            
            if (val.startsWith('basket_')) {
                const idx = parseInt(val.split('_')[1]);
                state.selectedDiscountId = CESTAS[idx].id;
            }
            
            state.step = next;
            nextStep();
        };

        // --- FUNÃ‡Ã•ES DE CARD UNIFICADO (CSS PURO) ---
        
        window.selectBasketChip = function(idx) {
            const container = document.getElementById('unified-card-content');
            if(!container) return;
            
            // Simples fade visual
            container.style.opacity = '0.5';
            setTimeout(() => {
                container.innerHTML = getCardContent(CESTAS[idx]);
                container.style.opacity = '1';
            }, 150);
        };

        function getCardContent(cesta) {
            const chips = CESTAS.map((c, i) => `
                <div class="chip-nav ${c.id === cesta.id ? 'selected' : ''}" onclick="selectBasketChip(${i})">
                    ${c.nome.replace('Cesta ', '')}
                </div>
            `).join('');

            const slides = cesta.items.map(item => {
                // Parser simples
                let qtd = "1 un", nome = item;
                const match = item.match(/^(\d+)\s+(.*)$/);
                if(match) { qtd = match[1]; nome = match[2]; }
                
                // Imagem generica para garantir load
                const img = `https://placehold.co/60x60/f3f4f6/999?text=${nome.substring(0,3).toUpperCase()}`;
                
                return `
                <div class="product-slide">
                    <img src="${img}" loading="lazy">
                    <span class="product-qty">${qtd}</span>
                    <span class="product-name">${nome}</span>
                </div>`;
            }).join('');

            const precos = cesta.opcoes.map(o => `
                <div class="price-item-row">
                    <span>${o.arroz.includes('Valor') ? 'Valor Ãšnico' : 'Com ' + o.arroz}</span>
                    <strong>R$ ${o.preco}</strong>
                </div>
            `).join('');

            return `
                <div class="card-top-row">
                    <div class="card-img-area">
                        ${cesta.destaque ? `<div class="selo-destaque">${cesta.destaque}</div>` : ''}
                        <img src="${cesta.img}" class="card-img-large" alt="${cesta.nome}">
                    </div>
                    <div class="card-chips-area">${chips}</div>
                </div>
                <div class="product-slider-container">
                    <div class="slider-wrapper">
                        <div class="product-slider">
                            ${slides}
                            <div style="min-width:10px"></div>
                        </div>
                        <div class="slider-arrow-indicator"><i class="fa-solid fa-chevron-right text-green-600"></i></div>
                    </div>
                </div>
                <div class="card-price-display-only">
                    ${precos}
                </div>
            `;
        }

        // --- FLUXO PRINCIPAL ---

        window.onload = async () => {
            trackEvent('PageView');
            await addMessage(`${getGreeting()}! Tudo bem? ðŸ‘‹`, 'bot', 500);
            await addMessage(`Aqui Ã© o <b>${CONFIG.ownerName}</b>, da Cesta BÃ¡sica Dona AntÃ´nia.`, 'bot', 800);
            await addMessage(`Qual Ã© o seu nome?`, 'bot', 600);
            userInput.focus();
        };

        async function handleInput() {
            const text = userInput.value.trim();
            if (!text) return;
            
            if (state.step === 0) {
                state.userName = text.split(' ')[0];
                state.step = 1;
                userInput.value = '';
                inputFooter.style.display = 'none'; // Esconde teclado
                await addMessage(text, 'user');
                nextStep();
            }
        }

        async function nextStep() {
            const name = state.userName;
            
            switch (state.step) {
                case 1:
                    await addMessage(`Prazer, ${name}! ðŸ˜€`);
                    await addMessage(`VocÃª jÃ¡ conhece nossas cestas?`);
                    showOptions([
                        { text: "Sim, jÃ¡ conheÃ§o ðŸ‘", val: "sim", next: 3 },
                        { text: "NÃ£o conheÃ§o ðŸ¤”", val: "nao", next: 2 }
                    ]);
                    break;
                
                case 2: // Mostra Empresa
                    // Card estÃ¡tico da empresa
                    const stats = [
                        {icon: 'fa-clock', txt: '8 anos em CuiabÃ¡ e VG', color: '#10b981'},
                        {icon: 'fa-truck', txt: '+30 mil Entregas', color: '#3b82f6'},
                        {icon: 'fa-thumbs-up', txt: '6 mil seguidores (Face)', color: '#8b5cf6'}
                    ].map(s => `
                        <div class="stat-row" style="background:${s.color}">
                            <i class="fa-solid ${s.icon}" style="margin-right:8px"></i> ${s.txt}
                        </div>
                    `).join('');
                    
                    const companyHTML = `
                        <div class="card-msg-container">
                        <div class="card-cesta-new">
                            <div class="company-header">
                                <img src="img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif" class="company-logo" onerror="this.src='https://api.dicebear.com/7.x/avataaars/svg?seed=Osvaldo'">
                                <div>
                                    <h3 style="margin:0; font-size:16px; color:#0f2546;">Dona AntÃ´nia</h3>
                                    <p style="margin:0; font-size:13px; color:#666;">Desde 2016</p>
                                </div>
                            </div>
                            <div class="company-stats-list">${stats}</div>
                        </div>
                        </div>
                    `;
                    await addMessage(companyHTML);
                    setTimeout(() => { state.step = 4; nextStep(); }, 3500);
                    break;

                case 3: 
                case 4:
                    await addMessage(state.step === 3 ? "Vou te mostrar as opÃ§Ãµes entÃ£o." : "Posso mostrar as cestas agora?");
                    showOptions([{ text: "Ver Cestas âœ…", val: "ok", next: 5 }]);
                    break;

                case 5: // Card Interativo
                    await addMessage(`Navegue pelas opÃ§Ãµes abaixo ðŸ‘‡`);
                    const cardHTML = `
                        <div class="card-msg-container">
                            <div class="card-cesta-new">
                                <div id="unified-card-content">
                                    ${getCardContent(CESTAS[0])}
                                </div>
                            </div>
                        </div>`;
                    await addMessage(cardHTML);
                    trackEvent('ViewContent', { content_name: 'Catalogo' });
                    
                    setTimeout(() => { state.step = 6; nextStep(); }, 12000); // 12s para ler
                    break;

                case 6:
                    await addMessage(`Gostou de alguma? Aceitamos CartÃ£o, PIX, Vale AlimentaÃ§Ã£o e Dinheiro.`);
                    setTimeout(() => { state.step = 8; nextStep(); }, 3000);
                    break;

                case 8: // Hook
                    await addMessage(`â­ ${name}, posso te dar um desconto na primeira compra?`);
                    showOptions([{ text: "Quero Desconto ðŸŽ", val: "sim", next: 9 }]);
                    break;

                case 9:
                    await addMessage(`Qual tamanho vocÃª prefere?`);
                    const opts = CESTAS.map((c, i) => ({
                        text: c.nome.replace('Cesta ', ''),
                        sub: `(${c.arrozQtd} Arroz)`,
                        val: `basket_${i}`,
                        next: 10
                    }));
                    showOptions(opts);
                    break;

                case 10: // Desconto
                    const selected = CESTAS.find(c => c.id === state.selectedDiscountId);
                    await addMessage(`Ã“tima escolha! Para a <b>${selected.nome}</b>, liberei isso:`);
                    
                    const discountHTML = `
                        <div class="card-msg-container">
                            <div class="discount-container">
                                <h3 style="color:#0F2546; margin-bottom:5px;">Desconto Liberado</h3>
                                <div class="discount-box">
                                    <span class="discount-val">- R$ ${selected.desconto},00</span>
                                    <small style="color:#d32f2f; font-weight:bold">VÃ¡lido 30 dias</small>
                                </div>
                                <button class="cta-btn" onclick="openWa('${selected.nome}', ${selected.desconto})">
                                    GARANTIR AGORA <i class="fa-solid fa-check-circle"></i>
                                </button>
                                <p style="font-size:10px; color:#999; margin-top:5px">Sem compromisso.</p>
                            </div>
                        </div>
                    `;
                    await addMessage(discountHTML);
                    await addMessage("Clique acima para garantir. ðŸ‘†");
                    await addMessage(`Salve nosso contato: <a href="https://wa.me/${CONFIG.whatsAppSaveNumber}?text=Estou%20salvando" target="_blank" class="text-link">65 99815-0965</a>`);
                    break;
            }
        }

        window.openWa = function(cesta, desconto) {
            const msg = `OlÃ¡! Sou ${state.userName}. Quero o desconto de R$ ${desconto} na ${cesta}.`;
            window.open(`https://wa.me/${CONFIG.whatsAppNumber}?text=${encodeURIComponent(msg)}`, '_blank');
            trackEvent('Lead');
            
            // Social final
            setTimeout(() => {
                const socialHTML = `
                    <div style="margin: 15px 0;">
                        <a href="${CONFIG.instagramLink}" target="_blank" class="social-btn"><i class="fa-brands fa-instagram"></i> Instagram</a>
                        <a href="${CONFIG.whatsAppGroupLink}" target="_blank" class="group-btn"><i class="fa-solid fa-star"></i> Grupo VIP</a>
                    </div>
                `;
                chatContainer.insertAdjacentHTML('beforeend', socialHTML);
                scrollToBottom();
            }, 2000);
        }

        sendBtn.onclick = handleInput;
        userInput.onkeypress = (e) => { if(e.key === 'Enter') handleInput(); }

    </script>
</body>
</html>
