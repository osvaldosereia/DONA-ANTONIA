<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastros | Sistema Local-First</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .scrollbar-thin::-webkit-scrollbar { width: 6px; height: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: #f1f1f1; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 3px; }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
        .nav-item.active { background-color: #1e293b; border-right: 4px solid #34d399; color: white; }
        .input-field { width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.9rem; outline: none; transition: all 0.2s; }
        .input-field:focus { border-color: #3b82f6; box-shadow: 0 0 0 1px #3b82f6; }
        .btn-primary { background-color: #1e293b; color: white; padding: 0.75rem; border-radius: 0.5rem; font-weight: 600; text-transform: uppercase; width: 100%; margin-top: 10px; }
        .btn-primary:hover { background-color: #334155; }
    </style>
    <script type="importmap">
    { "imports": { "react": "https://esm.sh/react@18.2.0", "react-dom/client": "https://esm.sh/react-dom@18.2.0/client", "lucide-react": "https://esm.sh/lucide-react@0.263.1", "zod": "https://esm.sh/zod@3.22.4" } }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-800 font-sans h-full">
    <div id="root" class="h-full"></div>
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { LayoutDashboard, ShoppingCart, Package, Truck, Database, LineChart, HeartHandshake, Menu, X, Search, Plus, Trash2, Phone, MessageCircle, BoxSelect } from 'lucide-react';

        const useStickyState = (key, defaultValue) => {
          const [value, setValue] = useState(() => {
            const stickyValue = window.localStorage.getItem(key);
            return stickyValue !== null ? JSON.parse(stickyValue) : defaultValue;
          });
          useEffect(() => { window.localStorage.setItem(key, JSON.stringify(value)); }, [key, value]);
          return [value, setValue];
        };
        const generateId = () => Math.random().toString(36).substr(2, 9);
        const formatCurrency = (val) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(val);

        const Sidebar = ({ mobileOpen }) => {
            const NavItem = ({ icon, label, href, active }) => (
                <a href={href} className={`w-full flex items-center justify-start gap-3 p-3 lg:px-6 transition-all duration-200 nav-item ${active ? 'active' : 'text-slate-400 hover:text-white hover:bg-slate-800'}`}>
                    {icon}<span className="font-medium text-sm">{label}</span>
                </a>
            );
            return (
                <aside className={`fixed inset-y-0 left-0 bg-slate-900 text-white flex flex-col transition-transform duration-300 z-40 w-64 lg:static lg:translate-x-0 ${mobileOpen ? 'translate-x-0 shadow-2xl' : '-translate-x-full'}`}>
                    <div className="h-16 flex items-center justify-center lg:justify-start lg:px-6 border-b border-slate-800">
                        <div className="bg-yellow-500 text-slate-900 p-1.5 rounded font-bold mr-2">LOG</div>
                        <h1 className="font-bold tracking-wider hidden lg:block text-lg">SISTEMA <span className="text-emerald-400 text-xs font-normal border border-emerald-500 rounded px-1 ml-1">V8.0</span></h1>
                    </div>
                    <nav className="flex-1 py-4 space-y-1 overflow-y-auto">
                        <NavItem icon={<LayoutDashboard size={20}/>} label="Visão Geral" href="../VISAOGERAL/" />
                        <NavItem icon={<ShoppingCart size={20}/>} label="Caixa (PDV)" href="../CAIXA-PDV/" />
                        <NavItem icon={<Package size={20}/>} label="Expedição" href="../EXPEDICAO/" />
                        <NavItem icon={<Truck size={20}/>} label="Logística" href="../LOGISTICA/" />
                        <NavItem icon={<Database size={20}/>} label="Cadastros" href="#" active={true} />
                        <NavItem icon={<LineChart size={20}/>} label="Relatórios" href="../RELATORIOS/" />
                        <NavItem icon={<HeartHandshake size={20}/>} label="Pós-Venda" href="../POS-VENDA/" />
                    </nav>
                </aside>
            );
        };

        function RegistryView({ clients, setClients, products, setProducts }) {
            const [tab, setTab] = useState('clients');
            const [cForm, setCForm] = useState({ name: '', phone: '', address: '', district: '' });
            const [pForm, setPForm] = useState({ name: '', price: '', stock: 0, category: 'ALIMENTOS' });
            const [search, setSearch] = useState('');

            const saveClient = () => {
                if (!cForm.name) return alert('Nome obrigatório');
                setClients([...clients, { ...cForm, id: generateId() }]);
                setCForm({ name: '', phone: '', address: '', district: '' });
                alert("Cliente Salvo!");
            };

            const saveProduct = () => {
                if (!pForm.name) return alert('Nome obrigatório');
                setProducts([...products, { ...pForm, id: generateId(), stockHistory: [] }]);
                setPForm({ name: '', price: '', stock: 0, category: 'ALIMENTOS' });
                alert("Produto Salvo!");
            };

            const list = tab === 'clients' 
                ? clients.filter(c => c.name.toLowerCase().includes(search.toLowerCase()))
                : products.filter(p => p.name.toLowerCase().includes(search.toLowerCase()));

            return (
                <div className="flex flex-col lg:flex-row h-full pb-20 lg:pb-0">
                    <div className="flex-1 border-r bg-white flex flex-col overflow-hidden order-2 lg:order-1">
                        <div className="p-4 border-b bg-gray-50/50">
                            <div className="flex bg-gray-200 p-1 rounded-lg mb-3 w-full max-w-sm">
                                <button onClick={() => setTab('clients')} className={`flex-1 py-1.5 text-xs font-bold rounded-md transition ${tab === 'clients' ? 'bg-white shadow text-blue-600' : 'text-gray-500'}`}>CLIENTES</button>
                                <button onClick={() => setTab('products')} className={`flex-1 py-1.5 text-xs font-bold rounded-md transition ${tab === 'products' ? 'bg-white shadow text-blue-600' : 'text-gray-500'}`}>PRODUTOS</button>
                            </div>
                            <input className="w-full p-2 border rounded-lg text-sm" placeholder="Buscar..." value={search} onChange={e => setSearch(e.target.value)} />
                        </div>
                        <div className="flex-1 overflow-auto p-0">
                            {list.map((item, i) => (
                                <div key={i} className="p-3 border-b hover:bg-gray-50 flex justify-between items-center">
                                    <div>
                                        <div className="font-bold text-sm text-gray-800">{item.name}</div>
                                        <div className="text-xs text-gray-500">{tab === 'clients' ? item.district : `Estoque: ${item.stock}`}</div>
                                    </div>
                                    <div className="font-bold text-xs text-emerald-600">{tab === 'products' && formatCurrency(item.price)}</div>
                                </div>
                            ))}
                        </div>
                    </div>
                    <div className="w-full lg:w-[380px] bg-gray-50 border-l shadow-xl z-20 flex flex-col order-1 lg:order-2 shrink-0 h-[400px] lg:h-full p-6">
                        <h2 className="font-bold text-gray-800 text-sm uppercase mb-4">{tab === 'clients' ? 'Novo Cliente' : 'Novo Produto'}</h2>
                        {tab === 'clients' ? (
                            <div className="space-y-3">
                                <div><label className="text-xs font-bold text-gray-400">NOME</label><input className="input-field" value={cForm.name} onChange={e => setCForm({...cForm, name: e.target.value})} /></div>
                                <div><label className="text-xs font-bold text-gray-400">TELEFONE</label><input className="input-field" value={cForm.phone} onChange={e => setCForm({...cForm, phone: e.target.value})} /></div>
                                <div><label className="text-xs font-bold text-gray-400">BAIRRO</label><input className="input-field" value={cForm.district} onChange={e => setCForm({...cForm, district: e.target.value})} /></div>
                                <button onClick={saveClient} className="btn-primary">SALVAR CLIENTE</button>
                            </div>
                        ) : (
                            <div className="space-y-3">
                                <div><label className="text-xs font-bold text-gray-400">PRODUTO</label><input className="input-field" value={pForm.name} onChange={e => setPForm({...pForm, name: e.target.value})} /></div>
                                <div><label className="text-xs font-bold text-gray-400">PREÇO (R$)</label><input className="input-field" type="number" value={pForm.price} onChange={e => setPForm({...pForm, price: e.target.value})} /></div>
                                <div><label className="text-xs font-bold text-gray-400">ESTOQUE INICIAL</label><input className="input-field" type="number" value={pForm.stock} onChange={e => setPForm({...pForm, stock: Number(e.target.value)})} /></div>
                                <button onClick={saveProduct} className="btn-primary">SALVAR PRODUTO</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function App() {
          const [clients, setClients] = useStickyState('db_clients_v3', []);
          const [products, setProducts] = useStickyState('db_products_v3', []);
          const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

          return (
            <div className="flex flex-col lg:flex-row h-screen bg-gray-100 font-sans text-gray-800 overflow-hidden">
                <div className="lg:hidden bg-slate-900 text-white p-4 flex justify-between items-center shrink-0 z-50">
                    <div className="flex items-center gap-2"><div className="bg-yellow-500 text-slate-900 p-1 rounded font-bold text-xs">LOG</div><h1 className="font-bold">CADASTROS</h1></div>
                    <button onClick={() => setMobileMenuOpen(!mobileMenuOpen)} className="p-2 bg-slate-800 rounded">{mobileMenuOpen ? <X size={20}/> : <Menu size={20}/>}</button>
                </div>
                <Sidebar mobileOpen={mobileMenuOpen} />
                <main className="flex-1 flex flex-col min-w-0 bg-gray-50 h-full relative">
                     <RegistryView clients={clients} setClients={setClients} products={products} setProducts={setProducts} />
                </main>
                {mobileMenuOpen && <div className="fixed inset-0 bg-black/50 z-30 lg:hidden" onClick={() => setMobileMenuOpen(false)}></div>}
            </div>
          );
        }
        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
