<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Módulo Gestão de Produtos (Micro-frontend)</title>
    
    <!-- 1. TAILWIND CSS (PROTOCOL) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: { 
                            850: '#151e2e', 
                            900: '#0f172a' // Fundo de botões primários
                        },
                        primary: { 
                            600: '#0284c7', // Azul Profundo
                            700: '#0369a1' 
                        }
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    boxShadow: {
                        'sharp': '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)',
                        'input': '0 1px 2px 0 rgba(0, 0, 0, 0.05)'
                    }
                }
            }
        }
    </script>
    
    <!-- 2. GOOGLE FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- 3. ESTILOS GLOBAIS (PROTOCOL) -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        
        /* Scrollbar */
        .scrollbar-thin::-webkit-scrollbar { width: 8px; height: 8px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: #e2e8f0; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; border: 2px solid #e2e8f0; }
        
        /* Inputs High Contrast */
        .input-label {
            display: block; font-size: 0.75rem; text-transform: uppercase;
            letter-spacing: 0.05em; font-weight: 700; color: #475569; margin-bottom: 0.35rem;
        }
        
        .input-field {
            width: 100%; padding: 0.6rem 0.75rem; 
            background-color: #ffffff; 
            border: 1px solid #cbd5e1; /* Slate-300 */
            border-radius: 0.375rem; font-size: 0.9rem; font-weight: 500; color: #0f172a;
            outline: none; transition: all 0.15s;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .input-field:focus { 
            border-color: #0284c7; /* Primary-600 */
            box-shadow: 0 0 0 2px rgba(2, 132, 199, 0.15); 
        }
        .input-field:disabled { background-color: #f1f5f9; color: #64748b; border-color: #e2e8f0; cursor: not-allowed; }
        
        /* Botões */
        .btn-primary {
            background-color: #0f172a; color: white;
            padding: 0.65rem 1.25rem; border-radius: 0.375rem;
            font-size: 0.875rem; font-weight: 600; letter-spacing: 0.025em;
            transition: background-color 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 0.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .btn-primary:hover { background-color: #1e293b; transform: translateY(-1px); }
        
        .btn-secondary {
            background-color: #ffffff; border: 1px solid #cbd5e1; color: #334155;
            padding: 0.65rem 1.25rem; border-radius: 0.375rem;
            font-size: 0.875rem; font-weight: 600;
            transition: all 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 0.5rem;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .btn-secondary:hover { background-color: #f8fafc; border-color: #94a3b8; color: #0f172a; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.2s ease-out; }
    </style>

    <!-- 4. IMPORTMAP -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1",
        "zod": "https://esm.sh/zod@3.22.4"
      }
    }
    </script>
    
    <!-- 5. BABEL -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-100 h-screen overflow-hidden text-slate-900">
    
    <div id="root" class="h-full"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { z } from 'zod';
        import { 
          Package, Search, Plus, Trash2, Save, BoxSelect, 
          ClipboardList, X, TrendingUp, AlertTriangle, ArrowRightLeft
        } from 'lucide-react';

        // --- UTILS ---
        const generateId = () => Math.random().toString(36).substr(2, 9);
        const formatCurrency = (value) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        
        const useStickyState = (key, defaultValue) => {
          const [value, setValue] = useState(() => {
            const stickyValue = window.localStorage.getItem(key);
            return stickyValue !== null ? JSON.parse(stickyValue) : defaultValue;
          });
          useEffect(() => {
            window.localStorage.setItem(key, JSON.stringify(value));
          }, [key, value]);
          return [value, setValue];
        };

        // --- APP CONTAINER ---
        function App() {
          const [products, setProducts] = useStickyState('db_products_v3', []);
          const [showStockManager, setShowStockManager] = useState(false);

          return (
            <div className="h-screen bg-slate-200 font-sans text-slate-900 overflow-hidden relative">
                
                {/* Micro-frontend Layout */}
                <ProductRegistry 
                    products={products} 
                    setProducts={setProducts} 
                    onOpenStockManager={() => setShowStockManager(true)}
                />

                {/* Modal Global: Stock Manager */}
                {showStockManager && (
                    <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[60] flex items-center justify-center p-4 animate-in">
                        <div className="bg-white w-full max-w-5xl h-[90vh] rounded-lg shadow-2xl flex flex-col overflow-hidden border border-slate-300">
                            <div className="bg-slate-50 border-b border-slate-200 p-4 flex justify-between items-center shrink-0">
                                <h2 className="font-bold text-slate-800 flex items-center gap-2 text-lg uppercase tracking-tight">
                                    <ClipboardList size={20} className="text-primary-600"/> Movimentação em Massa
                                </h2>
                                <button onClick={() => setShowStockManager(false)} className="hover:bg-slate-200 p-2 rounded-full transition text-slate-500 hover:text-red-600">
                                    <X size={24}/>
                                </button>
                            </div>
                            <StockManager products={products} setProducts={setProducts} />
                        </div>
                    </div>
                )}
            </div>
          );
        }

        // --- MAIN MODULE ---
        function ProductRegistry({ products, setProducts, onOpenStockManager }) {
            const [pForm, setPForm] = useState({ 
                name: '', internalCode: '', category: 'ALIMENTOS', 
                cost: '', price: '', stock: 0, isCombo: false, comboItems: [] 
            });
            const [editingProductId, setEditingProductId] = useState(null);
            const [search, setSearch] = useState('');

            // Logic
            const getNextProductCode = () => {
                const codes = products.map(p => parseInt(p.internalCode)).filter(n => !isNaN(n));
                const max = codes.length > 0 ? Math.max(...codes) : 0;
                return (max + 1).toString();
            };

            const startNew = () => {
                setPForm({ name: '', internalCode: getNextProductCode(), category: 'ALIMENTOS', cost: '', price: '', stock: 0, isCombo: false, comboItems: [] });
                setEditingProductId(null);
            };

            const saveProduct = () => { 
                if (!pForm.name.trim()) return alert('ERRO: Nome do produto é obrigatório');
                
                const cost = Number(pForm.cost) || 0;
                const price = Number(pForm.price) || 0;
                let margin = 0;
                if (price > 0) margin = ((price - cost) / price) * 100;
                
                if (margin < 20) {
                    if(!confirm(`ALERTA DE SEGURANÇA:\nMargem de lucro muito baixa (${margin.toFixed(1)}%).\nDeseja confirmar?`)) return;
                }

                if (editingProductId) { 
                    setProducts(products.map(p => p.id === editingProductId ? { ...pForm, id: editingProductId, stock: p.stock, stockHistory: p.stockHistory } : p)); 
                } else { 
                    const newProd = { ...pForm, id: generateId(), stockHistory: [{ date: new Date().toISOString(), type: 'INITIAL', qty: Number(pForm.stock) }] }; 
                    setProducts([...products, newProd]); 
                } 
                startNew();
            };

            const deleteItem = () => {
                if(!editingProductId || !confirm("AÇÃO IRREVERSÍVEL: Excluir este produto?")) return;
                setProducts(products.filter(p => p.id !== editingProductId));
                setEditingProductId(null);
                startNew();
            };

            const list = products.filter(p => 
                p.name.toLowerCase().includes(search.toLowerCase()) || 
                (p.internalCode && p.internalCode.includes(search))
            ).sort((a,b) => a.name.localeCompare(b.name));

            return (
                <div className="flex h-full bg-slate-200 overflow-hidden">
                    
                    {/* ESQUERDA: LISTAGEM */}
                    <aside className="w-full md:w-[450px] lg:w-[500px] flex flex-col bg-white border-r border-slate-300 shrink-0 z-10 shadow-lg">
                        {/* Header Busca */}
                        <div className="p-4 border-b border-slate-200 bg-slate-50">
                            <div className="flex justify-between items-center mb-3">
                                <h2 className="text-sm font-bold text-slate-800 uppercase tracking-wide flex items-center gap-2">
                                    <Package size={18} className="text-primary-600"/> Catálogo ({list.length})
                                </h2>
                            </div>
                            <div className="relative">
                                <Search className="absolute left-3 top-2.5 text-slate-500" size={18}/>
                                <input 
                                    className="w-full pl-10 pr-4 py-2.5 bg-white border border-slate-300 rounded text-sm font-medium focus:border-primary-600 focus:ring-1 focus:ring-primary-600 outline-none text-slate-900 placeholder:text-slate-400" 
                                    placeholder="Buscar (Nome, Cód)..." 
                                    value={search} 
                                    onChange={e => setSearch(e.target.value)} 
                                />
                            </div>
                        </div>

                        {/* Tabela Scrollável */}
                        <div className="flex-1 overflow-auto scrollbar-thin bg-white">
                            <table className="w-full text-left border-collapse">
                                <thead className="bg-slate-100 text-slate-500 sticky top-0 z-10 text-[10px] uppercase font-bold tracking-wider shadow-sm">
                                    <tr>
                                        <th className="p-3 border-b border-slate-200">Produto</th>
                                        <th className="p-3 border-b border-slate-200 text-right">Preço</th>
                                        <th className="p-3 border-b border-slate-200 text-center">Estoque</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-100">
                                    {list.map(p => {
                                        const isSelected = editingProductId === p.id;
                                        return (
                                            <tr 
                                                key={p.id} 
                                                onClick={() => { setPForm(p); setEditingProductId(p.id); }}
                                                className={`cursor-pointer transition-all border-l-4 ${isSelected ? 'bg-blue-50 border-primary-600' : 'border-transparent hover:bg-slate-50 hover:border-slate-300'}`}
                                            >
                                                <td className="p-3">
                                                    <div className="font-bold text-sm text-slate-800">{p.name}</div>
                                                    <div className="flex gap-2 mt-1">
                                                        <span className="text-[10px] font-mono bg-slate-100 px-1.5 rounded text-slate-500 border border-slate-200">{p.internalCode || 'S/C'}</span>
                                                        {p.isCombo && <span className="text-[9px] font-bold bg-amber-100 text-amber-700 px-1.5 rounded border border-amber-200">KIT</span>}
                                                    </div>
                                                </td>
                                                <td className="p-3 text-right">
                                                    <div className="font-bold text-sm text-primary-700">{formatCurrency(p.price)}</div>
                                                    <div className="text-[10px] text-slate-400">Custo: {formatCurrency(p.cost)}</div>
                                                </td>
                                                <td className="p-3 text-center">
                                                    <span className={`font-bold px-2 py-0.5 rounded text-xs ${p.stock <= 5 ? 'bg-red-100 text-red-700' : 'bg-slate-100 text-slate-700'}`}>
                                                        {p.stock}
                                                    </span>
                                                </td>
                                            </tr>
                                        );
                                    })}
                                    {list.length === 0 && (
                                        <tr><td colSpan="3" className="p-8 text-center text-slate-400 text-sm">Nenhum produto encontrado.</td></tr>
                                    )}
                                </tbody>
                            </table>
                        </div>
                        
                        {/* Mobile Action */}
                        <div className="p-4 border-t border-slate-200 bg-slate-50 md:hidden">
                            <button onClick={startNew} className="btn-primary w-full shadow-lg">
                                <Plus size={18}/> Novo Produto
                            </button>
                        </div>
                    </aside>

                    {/* DIREITA: FORMULÁRIO (Full & Clean) */}
                    <main className="flex-1 flex flex-col h-full bg-slate-100 overflow-hidden relative">
                        {/* Topbar */}
                        <div className="h-16 border-b border-slate-300 bg-white px-6 flex items-center justify-between shrink-0 shadow-sm z-20">
                            <div className="flex items-center gap-3">
                                <div className={`h-8 w-1 rounded-full ${editingProductId ? 'bg-amber-500' : 'bg-primary-600'}`}></div>
                                <div>
                                    <h1 className="text-xl font-bold text-slate-900 leading-tight">
                                        {editingProductId ? 'Editando Produto' : 'Novo Cadastro'}
                                    </h1>
                                    <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">
                                        WMS / ESTOQUE
                                    </p>
                                </div>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={onOpenStockManager} className="btn-secondary hidden lg:flex" title="Ajuste em Massa">
                                    <ClipboardList size={16}/> <span className="hidden xl:inline">Movimentar Estoque</span>
                                </button>
                                <div className="h-8 w-px bg-slate-200 mx-2 hidden lg:block"></div>
                                {editingProductId && (
                                    <button onClick={deleteItem} className="text-red-600 hover:bg-red-50 px-3 py-2 rounded transition border border-transparent hover:border-red-100">
                                        <Trash2 size={18}/>
                                    </button>
                                )}
                                <button onClick={startNew} className="btn-secondary hidden sm:flex">
                                    <Plus size={16}/> Limpar
                                </button>
                                <button onClick={saveProduct} className="btn-primary shadow-md">
                                    <Save size={18}/> SALVAR
                                </button>
                            </div>
                        </div>

                        {/* Form Content */}
                        <div className="flex-1 overflow-y-auto p-4 md:p-8 scrollbar-thin">
                            <div className="max-w-4xl mx-auto bg-white rounded-lg shadow border border-slate-300 p-6 md:p-8">
                                
                                <div className="grid grid-cols-1 md:grid-cols-12 gap-x-6 gap-y-6">
                                    
                                    {/* 1. Definição */}
                                    <div className="md:col-span-12 flex items-center gap-2 mb-2 border-b border-slate-100 pb-2">
                                        <span className="bg-slate-800 text-white text-[10px] font-bold px-2 py-0.5 rounded">1</span>
                                        <h3 className="text-sm font-bold text-slate-800 uppercase tracking-wide">Definição do SKU</h3>
                                    </div>

                                    <div className="md:col-span-8">
                                        <label className="input-label">Nome do Produto</label>
                                        <input className="input-field text-lg" value={pForm.name} onChange={e => setPForm({...pForm, name: e.target.value})} placeholder="Ex: Coca Cola 350ml" />
                                    </div>
                                    <div className="md:col-span-4">
                                        <label className="input-label">Código Interno</label>
                                        <input className="input-field font-mono font-bold text-slate-600 bg-slate-50 text-center" value={pForm.internalCode} onChange={e => setPForm({...pForm, internalCode: e.target.value})} />
                                    </div>
                                    <div className="md:col-span-6">
                                        <label className="input-label">Categoria</label>
                                        <input className="input-field" value={pForm.category} onChange={e => setPForm({...pForm, category: e.target.value})} list="categories" placeholder="Selecione..." />
                                        <datalist id="categories">
                                            <option value="BEBIDAS"/><option value="ALIMENTOS"/><option value="LIMPEZA"/><option value="EMBALAGENS"/>
                                        </datalist>
                                    </div>

                                    {/* 2. Precificação */}
                                    <div className="md:col-span-12 flex items-center gap-2 mt-4 mb-2 border-b border-slate-100 pb-2">
                                        <span className="bg-slate-800 text-white text-[10px] font-bold px-2 py-0.5 rounded">2</span>
                                        <h3 className="text-sm font-bold text-slate-800 uppercase tracking-wide">Custos & Preços</h3>
                                    </div>

                                    <div className="md:col-span-4">
                                        <label className="input-label">Custo (R$)</label>
                                        <input className="input-field" type="number" step="0.01" value={pForm.cost} onChange={e => setPForm({...pForm, cost: e.target.value})} placeholder="0.00" />
                                    </div>
                                    <div className="md:col-span-4">
                                        <label className="input-label text-primary-700">Preço de Venda (R$)</label>
                                        <input className="input-field font-bold text-primary-700 border-primary-200 bg-blue-50/30" type="number" step="0.01" value={pForm.price} onChange={e => setPForm({...pForm, price: e.target.value})} placeholder="0.00" />
                                    </div>
                                    <div className="md:col-span-4 flex items-end pb-1">
                                        {pForm.price > 0 && (
                                            <div className="w-full bg-slate-100 p-2 rounded border border-slate-200 text-center">
                                                <span className="text-[10px] uppercase font-bold text-slate-400 block">Margem Bruta</span>
                                                <span className={`font-bold ${((pForm.price - pForm.cost)/pForm.price) < 0.2 ? 'text-red-600' : 'text-green-600'}`}>
                                                    {(((pForm.price - pForm.cost)/pForm.price)*100).toFixed(1)}%
                                                </span>
                                            </div>
                                        )}
                                    </div>

                                    {/* 3. Estoque */}
                                    <div className="md:col-span-12 flex items-center gap-2 mt-4 mb-2 border-b border-slate-100 pb-2">
                                        <span className="bg-slate-800 text-white text-[10px] font-bold px-2 py-0.5 rounded">3</span>
                                        <h3 className="text-sm font-bold text-slate-800 uppercase tracking-wide">Controle de Estoque</h3>
                                    </div>

                                    <div className="md:col-span-4">
                                        <label className="input-label">Estoque Atual</label>
                                        <input 
                                            className="input-field text-center font-bold text-lg" 
                                            type="number" 
                                            value={pForm.stock} 
                                            disabled={pForm.isCombo}
                                            onChange={e => setPForm({...pForm, stock: Number(e.target.value)})} 
                                        />
                                        {pForm.isCombo && <span className="text-[10px] text-amber-600 font-bold block mt-1 text-center">*Calculado pelo Kit*</span>}
                                    </div>

                                    <div className="md:col-span-8 flex items-center pt-6">
                                        <label className={`flex items-center gap-3 cursor-pointer select-none p-3 rounded w-full border transition-all ${pForm.isCombo ? 'bg-amber-50 border-amber-300' : 'bg-slate-50 border-slate-200'}`}>
                                            <input type="checkbox" className="w-5 h-5 rounded text-amber-600" checked={pForm.isCombo} onChange={e => setPForm({...pForm, isCombo: e.target.checked})} />
                                            <div>
                                                <span className={`text-sm font-bold block ${pForm.isCombo ? 'text-amber-800' : 'text-slate-600'}`}>Produto Composto (Kit / Combo)</span>
                                                <span className="text-[10px] text-slate-400">O estoque deste item dependerá dos insumos.</span>
                                            </div>
                                        </label>
                                    </div>

                                    {/* Config do Kit */}
                                    {pForm.isCombo && (
                                        <div className="md:col-span-12 bg-amber-50/50 rounded border border-amber-200 p-4 mt-2 animate-in">
                                            <h4 className="font-bold text-amber-800 text-xs uppercase mb-3 flex items-center gap-2">
                                                <BoxSelect size={14}/> Composição do Kit (Baixa Automática)
                                            </h4>
                                            <div className="space-y-2 max-h-48 overflow-y-auto scrollbar-thin bg-white border border-amber-100 rounded p-1">
                                                {products.filter(p => !p.isCombo && p.id !== editingProductId).map(p => {
                                                    const itemInCombo = pForm.comboItems.find(i => i.id === p.id);
                                                    return (
                                                        <div key={p.id} className={`flex justify-between items-center text-xs p-2 border-b border-slate-50 last:border-0 hover:bg-slate-50 ${itemInCombo ? 'bg-amber-50' : ''}`}>
                                                            <div>
                                                                <span className="font-bold text-slate-700 block">{p.name}</span>
                                                                <span className="text-[10px] text-slate-400">Estoque: {p.stock}</span>
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                <span className="text-slate-400 text-[10px] uppercase font-bold">Qtd no Kit:</span>
                                                                <input 
                                                                    type="number" 
                                                                    className="w-16 border border-slate-300 rounded text-center p-1.5 bg-white focus:border-amber-500 outline-none font-bold" 
                                                                    placeholder="0" 
                                                                    value={itemInCombo?.qty || ''} 
                                                                    onChange={(e) => { 
                                                                        const qty = Number(e.target.value); 
                                                                        const existing = pForm.comboItems.filter(i => i.id !== p.id); 
                                                                        if (qty > 0) setPForm({...pForm, comboItems: [...existing, {id: p.id, qty}]}); 
                                                                        else setPForm({...pForm, comboItems: existing}); 
                                                                    }} 
                                                                />
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                                {products.filter(p => !p.isCombo).length === 0 && <div className="p-4 text-center text-slate-400 text-xs italic">Nenhum produto simples disponível para compor o kit.</div>}
                                            </div>
                                        </div>
                                    )}

                                </div>
                            </div>
                            <div className="h-10"></div>
                        </div>
                    </main>
                </div>
            );
        }

        // --- SUB-MODAL: STOCK MANAGER (Design Refinado) ---
        function StockManager({ products, setProducts }) {
             const [bulkIn, setBulkIn] = useState(''); 
             const [bulkOut, setBulkOut] = useState(''); 
             const sortedProducts = [...products].sort((a,b) => a.name.localeCompare(b.name));
             
             const processBulk = (text, type) => { 
                 const lines = text.split('\n'); 
                 const newProducts = [...products]; 
                 let count = 0;
                 let errors = []; 
                 
                 lines.forEach(line => { 
                     if(!line.trim()) return; 
                     const parts = line.split(/[|\t]+/); 
                     const code = parts[0]?.trim(); 
                     const qty = parseInt(parts[1]?.trim()); 

                     if (!code || isNaN(qty)) return; 
                     
                     const prodIndex = newProducts.findIndex(p => 
                        (p.internalCode && p.internalCode === code) || 
                        (p.name.toUpperCase() === code.toUpperCase())
                     ); 
                     
                     if (prodIndex !== -1) { 
                         const prod = newProducts[prodIndex]; 
                         if (type === 'IN') prod.stock += qty; 
                         else prod.stock -= qty; 
                         count++;
                     } else { 
                        errors.push(code); 
                     } 
                 }); 
                 
                 setProducts(newProducts); 
                 
                 let msg = `${type === 'IN' ? 'ENTRADA' : 'SAÍDA'} CONCLUÍDA!\n${count} itens atualizados.`;
                 if(errors.length > 0) msg += `\n❌ Não encontrados: ${errors.join(', ')}`;
                 alert(msg);
                 
                 if(type === 'IN') setBulkIn(''); else setBulkOut(''); 
            };

             return (
                <div className="flex h-full flex-col lg:flex-row bg-slate-100">
                    {/* Lista Referência */}
                    <div className="w-full lg:w-1/3 border-r border-slate-300 bg-white flex flex-col shadow-inner">
                        <div className="p-3 bg-slate-50 border-b border-slate-200">
                            <h4 className="font-bold text-slate-500 uppercase text-xs flex items-center gap-2">
                                <Search size={12}/> Referência de Códigos
                            </h4>
                        </div>
                        <div className="flex-1 overflow-y-auto scrollbar-thin p-2">
                            {sortedProducts.map(p => (
                                <div key={p.id} className="flex justify-between items-center text-xs p-2 border-b border-slate-100 hover:bg-slate-50 rounded">
                                    <div>
                                        <span className="font-bold text-slate-800">{p.name}</span>
                                        <div className="text-[10px] text-slate-400 font-mono mt-0.5">{p.internalCode || 'S/ COD'}</div>
                                    </div>
                                    <span className="font-bold text-slate-500 bg-slate-100 px-1.5 rounded">{p.stock}</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Área de Ação */}
                    <div className="flex-1 p-6 space-y-4 overflow-y-auto bg-slate-100">
                        <div className="bg-blue-50 border border-blue-200 p-4 rounded-md text-sm text-blue-800 flex gap-3">
                            <AlertTriangle size={20} className="shrink-0"/>
                            <div>
                                <strong>Como usar:</strong> Cole linhas do Excel ou Bloco de Notas.<br/>
                                Padrão: <code>CÓDIGO | QUANTIDADE</code> (Ex: <code>789100 | 50</code>)
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            {/* Entrada */}
                            <div className="bg-white p-5 rounded-lg shadow-sm border border-emerald-200 flex flex-col h-[400px]">
                                <h3 className="font-bold text-emerald-700 mb-3 flex items-center gap-2 uppercase text-sm">
                                    <ArrowRightLeft size={16} className="rotate-90 md:rotate-0"/> Entrada de Estoque
                                </h3>
                                <textarea 
                                    className="flex-1 w-full border border-slate-200 p-3 text-xs font-mono bg-slate-50 focus:bg-white focus:border-emerald-500 outline-none rounded transition resize-none" 
                                    placeholder="COLA AQUI..." 
                                    value={bulkIn} 
                                    onChange={e=>setBulkIn(e.target.value)}
                                ></textarea>
                                <button onClick={()=>processBulk(bulkIn, 'IN')} className="w-full bg-emerald-600 text-white font-bold py-3 rounded mt-3 hover:bg-emerald-700 transition shadow-sm uppercase text-sm tracking-wide">
                                    Processar Entrada
                                </button>
                            </div>

                            {/* Saída */}
                            <div className="bg-white p-5 rounded-lg shadow-sm border border-rose-200 flex flex-col h-[400px]">
                                <h3 className="font-bold text-rose-700 mb-3 flex items-center gap-2 uppercase text-sm">
                                    <ArrowRightLeft size={16} className="rotate-90 md:rotate-0"/> Baixa / Saída
                                </h3>
                                <textarea 
                                    className="flex-1 w-full border border-slate-200 p-3 text-xs font-mono bg-slate-50 focus:bg-white focus:border-rose-500 outline-none rounded transition resize-none" 
                                    placeholder="COLA AQUI..." 
                                    value={bulkOut} 
                                    onChange={e=>setBulkOut(e.target.value)}
                                ></textarea>
                                <button onClick={()=>processBulk(bulkOut, 'OUT')} className="w-full bg-rose-600 text-white font-bold py-3 rounded mt-3 hover:bg-rose-700 transition shadow-sm uppercase text-sm tracking-wide">
                                    Processar Saída
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
