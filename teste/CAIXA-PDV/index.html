<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDV - Sistema Log√≠stica v8.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .scrollbar-thin::-webkit-scrollbar { width: 6px; height: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: #f1f1f1; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 3px; }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
        .input-field { width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.9rem; outline: none; transition: all 0.2s; }
        .input-field:focus { border-color: #3b82f6; box-shadow: 0 0 0 1px #3b82f6; }
        .nav-item.active { background-color: #334155; border-right: 4px solid #34d399; }
    </style>
    <script type="importmap">
    { "imports": { "react": "https://esm.sh/react@18.2.0", "react-dom/client": "https://esm.sh/react-dom@18.2.0/client", "lucide-react": "https://esm.sh/lucide-react@0.263.1", "zod": "https://esm.sh/zod@3.22.4" } }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-800 font-sans h-full">
    <div id="root" class="h-full"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { LayoutDashboard, ShoppingCart, Package, Truck, Database, LineChart, HeartHandshake, Menu, X, Search, Plus, XCircle, Wallet, ClipboardList } from 'lucide-react';

        // --- UTILS ---
        const generateId = () => Math.random().toString(36).substr(2, 9);
        const generateDailyId = (sales) => {
            const today = new Date().toISOString().slice(0, 10);
            const todaysSales = sales.filter(s => s.date.startsWith(today));
            const count = todaysSales.length + 1;
            return count > 99 ? count.toString() : count.toString().padStart(2, '0');
        };
        const useStickyState = (key, defaultValue) => {
          const [value, setValue] = useState(() => {
            const stickyValue = window.localStorage.getItem(key);
            return stickyValue !== null ? JSON.parse(stickyValue) : defaultValue;
          });
          useEffect(() => { window.localStorage.setItem(key, JSON.stringify(value)); }, [key, value]);
          return [value, setValue];
        };
        const formatCurrency = (value) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);

        // --- COMPONENTS ---
        const NavItem = ({ icon, label, href, active }) => (
            <a href={href} className={`w-full flex items-center justify-start gap-3 p-3 lg:px-6 transition-all duration-200 nav-item ${active ? 'active text-white bg-slate-800' : 'text-slate-400 hover:text-white hover:bg-slate-800'}`} title={label}>{icon}<span className="font-medium text-sm">{label}</span></a>
        );

        // --- STOCK MANAGER (Modal) ---
        function StockManager({ products, setProducts }) {
             const [bulkIn, setBulkIn] = useState(''); const [bulkOut, setBulkOut] = useState(''); const sortedProducts = [...products].sort((a,b) => a.name.localeCompare(b.name));
             const processBulk = (text, type) => { 
                 const lines = text.split('\n'); const newProducts = [...products]; let log = []; let errors = []; 
                 lines.forEach(line => { 
                     if(!line.trim()) return; 
                     const parts = line.split(/[|\t]+/); 
                     const code = parts[0]?.trim(); const qty = parseInt(parts[1]?.trim()); const validity = parts[2]?.trim();
                     if (!code || isNaN(qty)) return; 
                     const prodIndex = newProducts.findIndex(p => (p.internalCode && p.internalCode === code) || (p.barcode && p.barcode === code) || (p.name.toUpperCase() === code.toUpperCase())); 
                     if (prodIndex !== -1) { 
                         const prod = newProducts[prodIndex]; const oldStock = prod.stock; 
                         if (type === 'IN') { prod.stock += qty; prod.stockHistory.push({ date: new Date().toISOString(), type: 'BULK_IN', qty, validity }); log.push(`${prod.name}: ${oldStock} -> ${prod.stock}`); } 
                         else { prod.stock -= qty; prod.stockHistory.push({ date: new Date().toISOString(), type: 'BULK_OUT', qty }); log.push(`${prod.name}: ${oldStock} -> ${prod.stock}`); } 
                     } else { errors.push(code); } 
                 }); 
                 setProducts(newProducts); let resultMsg = `${type === 'IN' ? 'ENTRADA' : 'SA√çDA'} PROCESSADA!\n\n`; if(log.length > 0) resultMsg += `Itens: ${log.length}\n`; if(errors.length > 0) resultMsg += `\nErros: ${errors.join(', ')}`; alert(resultMsg); if(type === 'IN') setBulkIn(''); else setBulkOut(''); 
            };
             return (<div className="flex h-full flex-col lg:flex-row"><div className="w-full lg:w-1/3 border-r bg-gray-50 p-4 overflow-y-auto scrollbar-thin h-[300px] lg:h-full">{sortedProducts.map(p => (<div key={p.id} className="flex justify-between items-center text-xs py-2 border-b"><div><span className="font-bold block">{p.name}</span><span className="text-[10px] text-gray-500">{p.internalCode}</span></div><span className={`font-bold px-2 py-1 rounded ${p.stock <= 5 ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`}>{p.stock}</span></div>))}</div><div className="flex-1 p-6 space-y-4 overflow-y-auto"><div className="grid grid-cols-1 md:grid-cols-2 gap-6"><div><h3 className="font-bold text-green-700 mb-2">Entrada em Massa</h3><textarea className="w-full h-64 border p-2 text-xs font-mono bg-green-50" placeholder="COD | QTD" value={bulkIn} onChange={e=>setBulkIn(e.target.value)}></textarea><button onClick={()=>processBulk(bulkIn, 'IN')} className="w-full bg-green-600 text-white font-bold py-2 rounded hover:bg-green-700 mt-2">PROCESSAR ENTRADA</button></div><div><h3 className="font-bold text-red-700 mb-2">Sa√≠da em Massa</h3><textarea className="w-full h-64 border p-2 text-xs font-mono bg-red-50" placeholder="COD | QTD" value={bulkOut} onChange={e=>setBulkOut(e.target.value)}></textarea><button onClick={()=>processBulk(bulkOut, 'OUT')} className="w-full bg-red-600 text-white font-bold py-2 rounded hover:bg-red-700 mt-2">PROCESSAR SA√çDA</button></div></div></div></div>)
        }

        // --- POS VIEW ---
        function POSView({ clients, products, setProducts, sales, setSales, saleToEdit, setSaleToEdit }) {
             const [selectedClient, setSelectedClient] = useState('');
             const [clientSearch, setClientSearch] = useState('');
             const [cart, setCart] = useState([]);
             
             // Sale Fields
             const [saleRegion, setSaleRegion] = useState('');
             const [isPaid, setIsPaid] = useState(false);
             const [gift, setGift] = useState('Nenhum');
             const [discount, setDiscount] = useState(0);
             const [useCashback, setUseCashback] = useState(false);
             const [cashbackVal, setCashbackVal] = useState(0);
             const [payMethod, setPayMethod] = useState('Pix');
             const [changeFor, setChangeFor] = useState(''); 
             const [obs, setObs] = useState(''); 
             const [searchProd, setSearchProd] = useState('');
             const [selectedCategory, setSelectedCategory] = useState('todas');
             const [editingItem, setEditingItem] = useState(null); 
             const [volumes, setVolumes] = useState(1); 
             const [tempQty, setTempQty] = useState({});
             
             const productSalesCount = useMemo(() => {
                 const counts = {};
                 sales.forEach(s => { s.items.forEach(i => { counts[i.name] = (counts[i.name] || 0) + (i.qty || 1); }); });
                 return counts;
             }, [sales]);

             const subTotal = useMemo(() => cart.reduce((acc, item) => acc + Number(item.price), 0), [cart]);
             const totalFinal = Math.max(0, subTotal - discount - (useCashback ? cashbackVal : 0));

             useEffect(() => {
                // If there's a sale to edit coming from URL params or state (simulated here)
                const params = new URLSearchParams(window.location.search);
                const editId = params.get('edit_id');
                if (editId) {
                   const sale = sales.find(s => s.id === editId);
                   if (sale && !saleToEdit) setSaleToEdit(sale);
                }

                if (saleToEdit) {
                  const client = clients.find(c => c.id === saleToEdit.clientId);
                  if (client) { setSelectedClient(client.id); setClientSearch(client.name); }
                  setCart(saleToEdit.items.map(i => ({...i, tempId: generateId()})));
                  setObs(saleToEdit.obs); setPayMethod(saleToEdit.payMethod);
                  if (saleToEdit.changeFor) setChangeFor(saleToEdit.changeFor);
                  setVolumes(saleToEdit.volumes || 1);
                  setSaleRegion(saleToEdit.regionOverride || (client ? client.region : ''));
                  setIsPaid(saleToEdit.isPaid || false);
                  setGift(saleToEdit.gift || 'Nenhum');
                  setDiscount(saleToEdit.discount || 0);
                  if (saleToEdit.cashbackValue > 0) { setUseCashback(true); setCashbackVal(saleToEdit.cashbackValue); }
                  // Remove param after loading
                  window.history.replaceState({}, document.title, "pos.html");
                }
              }, [saleToEdit, clients, sales]);
    
             const getQty = (id) => tempQty[id] || 1;
             const addToCart = (product) => {
                const qty = getQty(product.id);
                if (!product.isCombo && product.stock < qty) { if (!confirm(`Estoque baixo (${product.stock}). Adicionar ${qty} mesmo assim?`)) return; }
                const itemsToAdd = [];
                for(let i=0; i<qty; i++) {
                   const cartItem = { 
                       ...product, tempId: generateId(), originalPrice: product.price,
                       comboItems: product.isCombo ? product.comboItems.map(ci => {
                           const subProd = products.find(p => p.id === ci.id);
                           const subTotalTable = product.comboItems.reduce((acc, item) => { const p = products.find(prod => prod.id === item.id); return acc + ((p?.price || 0) * item.qty); }, 0);
                           const ratio = subTotalTable > 0 ? product.price / subTotalTable : 1;
                           return { ...ci, internalPrice: (subProd?.price || 0) * ratio }; 
                       }) : []
                   };
                   itemsToAdd.push(cartItem);
                }
                setCart([...cart, ...itemsToAdd]);
                setTempQty({...tempQty, [product.id]: 1}); 
             };

             const finalizeSale = () => {
                if (!selectedClient) return alert('Selecione um cliente');
                if (cart.length === 0) return alert('Carrinho vazio');
                
                const newProducts = [...products];
                cart.forEach(cartItem => {
                  const dbProd = newProducts.find(p => p.id === cartItem.id);
                  if (dbProd) {
                    if (dbProd.isCombo) {
                      cartItem.comboItems?.forEach(ing => {
                         const dbIng = newProducts.find(p => p.id === ing.id);
                         if (dbIng) {
                           dbIng.stock = Math.max(0, dbIng.stock - ing.qty);
                           dbIng.stockHistory.push({ date: new Date().toISOString(), type: 'SALE_COMBO', qty: ing.qty, ref: cartItem.name });
                         }
                      });
                    } else {
                      dbProd.stock = Number(dbProd.stock) - 1;
                      dbProd.stockHistory.push({ date: new Date().toISOString(), type: 'SALE', qty: 1 });
                    }
                  }
                });
                
                setProducts(newProducts);
                // If editing, remove old sale first (conceptually), but here we usually create new or update. Assuming create new for simplicity or overwrite if logic exists.
                // For simplicity in this split, we create NEW ID always unless handled deeper.
                const shortId = generateDailyId(sales);
                const newSale = {
                  id: shortId, fullId: generateId(), clientId: selectedClient, items: cart,
                  subTotal, discount, total: totalFinal, 
                  payMethod, changeFor: payMethod === 'Dinheiro' ? changeFor : null, obs,
                  date: new Date().toISOString(), status: 'Pendente', printedLabel: false, printedList: false, volumes, routeId: null,
                  regionOverride: saleRegion, gift, isPaid, cashbackValue: useCashback ? cashbackVal : 0
                };
                
                if (saleToEdit) {
                    // Replace logic
                    const updatedSales = sales.map(s => s.id === saleToEdit.id ? { ...newSale, id: saleToEdit.id } : s);
                    setSales(updatedSales);
                    setSaleToEdit(null);
                    alert(`Venda #${saleToEdit.id} Atualizada!`);
                } else {
                    setSales([...sales, newSale]);
                    alert(`Venda #${shortId} Realizada!`);
                }

                setCart([]); setSelectedClient(''); setClientSearch(''); setObs(''); setChangeFor(''); setVolumes(1); 
                setSaleRegion(''); setIsPaid(false); setGift('Nenhum'); setDiscount(0); setUseCashback(false); setCashbackVal(0);
             };

             const sortedProducts = useMemo(() => {
                 return [...products].sort((a, b) => {
                     const soldA = productSalesCount[a.name] || 0; const soldB = productSalesCount[b.name] || 0;
                     if (soldB !== soldA) return soldB - soldA; 
                     return a.name.localeCompare(b.name);
                 });
             }, [products, productSalesCount]);

             const filteredProducts = sortedProducts.filter(p => (selectedCategory === 'todas' || p.category === selectedCategory) && p.name.toLowerCase().includes(searchProd.toLowerCase()));
             const filteredClients = clients.filter(c => c.name.toLowerCase().includes(clientSearch.toLowerCase()));
             const categories = ['todas', ...new Set(products.map(p => p.category))];

             return (
                <div className="flex flex-col lg:flex-row min-h-full h-full">
                    {/* LEFT: PRODUCTS */}
                    <div className="flex-1 flex flex-col lg:border-r bg-white p-4 h-full overflow-hidden">
                        <div className="flex gap-2 lg:gap-4 mb-4 shrink-0">
                            <div className="relative flex-1"><Search className="absolute left-3 top-2.5 text-gray-400" size={20}/><input className="w-full pl-10 pr-4 py-2 border rounded-lg bg-gray-50 focus:bg-white focus:border-blue-500 outline-none transition" placeholder="Buscar produto..." value={searchProd} onChange={e => setSearchProd(e.target.value)} /></div>
                            <select className="border rounded-lg px-2 lg:px-4 bg-white outline-none focus:border-blue-500 max-w-[100px] lg:max-w-none" value={selectedCategory} onChange={e => setSelectedCategory(e.target.value)}><option value="todas">Todas</option>{categories.filter(c=>c!=='todas').map(c => <option key={c} value={c}>{c}</option>)}</select>
                        </div>
                        <div className="flex-1 overflow-y-auto scrollbar-thin border rounded-lg">
                            <table className="w-full text-left border-collapse">
                                <thead className="bg-gray-100 text-gray-600 text-xs uppercase sticky top-0 z-10 shadow-sm"><tr><th className="p-2 border-b">Produto</th><th className="p-2 border-b text-center hidden sm:table-cell">Categ</th><th className="p-2 border-b text-center">Est</th><th className="p-2 border-b text-right">Pre√ßo</th><th className="p-2 border-b text-center">Add</th></tr></thead>
                                <tbody className="text-sm divide-y divide-gray-100">{filteredProducts.map(p => (<tr key={p.id} className="hover:bg-gray-50 cursor-pointer group" onClick={() => addToCart(p)}><td className="p-2"><div className="font-bold text-gray-800 leading-tight">{p.name}</div><div className="text-[10px] text-gray-500 flex gap-2 items-center mt-0.5">{productSalesCount[p.name] > 0 && <span className="bg-orange-100 text-orange-800 px-1 rounded font-bold text-[9px] flex items-center">üî• {productSalesCount[p.name]}</span>}{p.internalCode && <span>C√≥d: {p.internalCode}</span>}{p.isCombo && <span className="bg-yellow-100 text-yellow-800 px-1 rounded font-bold text-[9px]">COMBO</span>}</div></td><td className="p-2 text-center hidden sm:table-cell"><span className="text-[10px] bg-gray-100 px-1.5 rounded text-gray-600">{p.category}</span></td><td className="p-2 text-center font-bold text-xs"><span className={p.stock < 5 ? 'text-red-600' : 'text-green-600'}>{p.stock}</span></td><td className="p-2 text-right font-bold text-emerald-600">{formatCurrency(p.price)}</td><td className="p-2 text-center"><button className="bg-blue-600 hover:bg-blue-700 text-white p-1 rounded transition shadow-sm"><Plus size={16}/></button></td></tr>))}</tbody>
                            </table>
                        </div>
                    </div>
                    {/* RIGHT: CART */}
                    <div className="w-full lg:w-[420px] flex flex-col bg-gray-50 border-t lg:border-t-0 lg:border-l shadow-xl z-20 shrink-0 h-full overflow-hidden">
                        <div className="p-4 bg-white border-b space-y-3 shrink-0">
                            <div>
                                <label className="text-xs font-bold text-gray-500 uppercase mb-1 block">Cliente</label>
                                <div className="relative"><input className={`w-full p-3 border rounded-lg outline-none transition ${selectedClient ? 'bg-green-50 border-green-500 text-green-800 font-bold' : 'bg-white focus:border-blue-500'}`} placeholder="Buscar Cliente..." value={clientSearch} onChange={e => { setClientSearch(e.target.value); setSelectedClient(''); }} />
                                    {clientSearch && !selectedClient && (<div className="absolute top-full left-0 w-full bg-white border shadow-xl max-h-60 overflow-y-auto z-50 rounded-b-lg">{filteredClients.map(c => (<div key={c.id} className="p-3 hover:bg-blue-50 cursor-pointer border-b flex justify-between items-center" onClick={() => { setSelectedClient(c.id); setClientSearch(c.name); setSaleRegion(c.region || ''); }}><div><div className="font-bold text-sm">{c.name}</div><div className="text-xs text-gray-500">{c.district}</div></div></div>))}</div>)}
                                </div>
                            </div>
                            <div><label className="text-xs font-bold text-gray-500 uppercase mb-1 block">Rota (Edit√°vel)</label><select className="w-full border rounded p-2 text-sm bg-gray-50 outline-none focus:bg-white focus:border-blue-500" value={saleRegion} onChange={e => setSaleRegion(e.target.value)}><option value="">Selecione...</option><option value="CUIAB√Å">CUIAB√Å (Centro)</option><option value="COXIPO">COXIPO</option><option value="VARZEA GRANDE">VARZEA GRANDE</option><option value="CPA">CPA</option>{!['CUIAB√Å', 'COXIPO', 'VARZEA GRANDE', 'CPA', ''].includes(saleRegion) && <option value={saleRegion}>{saleRegion}</option>}</select></div>
                        </div>
                        <div className="flex-1 p-4 space-y-2 overflow-y-auto">
                            {cart.length === 0 && (<div className="h-32 flex flex-col items-center justify-center text-gray-400 opacity-60"><ShoppingCart size={48} className="mb-2"/><p>Carrinho Vazio</p></div>)}
                            {cart.map(item => (
                                <div key={item.tempId} className="bg-white p-3 rounded-lg border shadow-sm relative group">
                                    <div className="flex justify-between items-start mb-1"><div className="font-bold text-sm text-gray-800 pr-6">{item.name}</div><button onClick={() => setCart(cart.filter(i => i.tempId !== item.tempId))} className="text-gray-300 hover:text-red-500 absolute top-2 right-2"><XCircle size={16}/></button></div>
                                    <div className="flex justify-between items-center"><button onClick={() => setEditingItem({tempId: item.tempId, price: item.price})} className="text-sm font-bold text-green-700 hover:underline">{formatCurrency(item.price)}</button><div className="text-xs text-gray-400">Unit√°rio</div></div>
                                </div>
                            ))}
                        </div>
                        <div className="bg-white border-t p-4 shrink-0 pb-6 lg:pb-4">
                            <div className="flex justify-between items-end mb-2"><div><label className="text-[10px] font-bold text-gray-400 uppercase">Subtotal</label><div className="text-sm text-gray-600">{formatCurrency(subTotal)}</div></div><div><label className="text-[10px] font-bold text-gray-400 uppercase">Desconto (R$)</label><input type="number" className="w-24 border-b border-gray-300 text-right text-sm outline-none focus:border-red-500 text-red-500 p-1" value={discount} onChange={e => setDiscount(parseFloat(e.target.value)||0)} /></div></div>
                            <div className="flex items-center justify-between mb-2 p-2 bg-pink-50 rounded border border-pink-100"><label className="flex items-center gap-2 cursor-pointer"><input type="checkbox" checked={useCashback} onChange={e => setUseCashback(e.target.checked)} className="w-4 h-4 text-pink-600 rounded focus:ring-pink-500" /><span className="text-xs font-bold text-pink-800 flex items-center gap-1"><Wallet size={12}/> CASHBACK</span></label>{useCashback && (<input type="number" className="w-20 border-b border-pink-300 text-right text-sm outline-none bg-transparent font-bold text-pink-700" placeholder="R$ 0,00" value={cashbackVal} onChange={e => setCashbackVal(parseFloat(e.target.value) || 0)} />)}</div>
                            <div className="flex justify-between items-center mb-4 pt-2 border-t"><span className="text-gray-500 font-bold uppercase text-xs">Total Final</span><span className="font-bold text-2xl text-emerald-600">{formatCurrency(totalFinal)}</span></div>
                            <div className="grid grid-cols-2 gap-3 mb-2"><div><label className="text-[10px] font-bold text-gray-400 uppercase">Pagamento</label><select className="w-full border rounded p-2 text-sm bg-gray-50 outline-none" value={payMethod} onChange={e => setPayMethod(e.target.value)}><option value="Pix">Pix</option><option value="Dinheiro">Dinheiro</option><option value="Cart√£o">Cart√£o</option></select></div><div><label className="text-[10px] font-bold text-gray-400 uppercase">Brinde</label><select className="w-full border rounded p-2 text-sm bg-gray-50 outline-none" value={gift} onChange={e => setGift(e.target.value)}><option value="Nenhum">Nenhum</option><option value="Amaciante">Amaciante</option><option value="Caf√©">Caf√©</option><option value="Ovo">Ovo</option></select></div></div>
                            <button onClick={finalizeSale} className="w-full bg-slate-900 text-white font-bold py-4 rounded-xl hover:bg-slate-800 transition shadow-lg flex justify-between items-center px-6 text-lg"><span>FINALIZAR</span><span className="text-emerald-400">{formatCurrency(totalFinal)}</span></button>
                        </div>
                    </div>
                    {editingItem && (<div className="absolute inset-0 bg-black/50 z-50 flex flex-col items-center justify-center p-4"><div className="bg-white p-6 rounded-xl shadow-2xl flex flex-col gap-4 w-72"><h3 className="text-sm font-bold text-center">Ajustar Pre√ßo</h3><input type="number" autoFocus className="text-3xl font-bold text-center border-b-2 border-blue-500 outline-none pb-2 w-full" value={editingItem.price} onChange={e => setEditingItem({...editingItem, price: e.target.value})}/><div className="flex gap-2"><button onClick={() => setEditingItem(null)} className="flex-1 bg-gray-100 py-2 rounded font-bold text-gray-500">Cancelar</button><button onClick={() => { setCart(cart.map(i => i.tempId === editingItem.tempId ? { ...i, price: parseFloat(editingItem.price) } : i)); setEditingItem(null); }} className="flex-1 bg-blue-600 text-white py-2 rounded font-bold">Salvar</button></div></div></div>)}
                </div>
             );
        }

        // --- MAIN APP ---
        function App() {
          const [clients] = useStickyState('db_clients_v3', []);
          const [products, setProducts] = useStickyState('db_products_v3', []);
          const [sales, setSales] = useStickyState('db_sales_v3', []);
          const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
          const [showStockManager, setShowStockManager] = useState(false);
          const [saleToEdit, setSaleToEdit] = useState(null);

          return (
            <div className="flex flex-col lg:flex-row h-screen bg-gray-100 font-sans text-gray-800 overflow-hidden">
                <div className="lg:hidden bg-slate-900 text-white p-4 flex justify-between items-center shrink-0 z-50 shadow-md">
                    <div className="flex items-center gap-2"><div className="bg-yellow-500 text-slate-900 p-1 rounded font-bold text-xs">LOG</div><h1 className="font-bold tracking-wider">SISTEMA v8.0</h1></div>
                    <button onClick={() => setMobileMenuOpen(!mobileMenuOpen)} className="p-2 bg-slate-800 rounded">{mobileMenuOpen ? <X size={20}/> : <Menu size={20}/>}</button>
                </div>
                <aside className={`fixed inset-y-0 left-0 bg-slate-900 text-white flex flex-col transition-transform duration-300 z-40 w-64 lg:static lg:translate-x-0 ${mobileMenuOpen ? 'translate-x-0 shadow-2xl' : '-translate-x-full'}`}>
                    <div className="h-16 hidden lg:flex items-center justify-center lg:justify-start lg:px-6 border-b border-slate-800">
                        <div className="bg-yellow-500 text-slate-900 p-1.5 rounded font-bold mr-2">LOG</div><h1 className="font-bold tracking-wider hidden lg:block text-lg">SISTEMA <span className="text-emerald-400 text-xs font-normal border border-emerald-500 rounded px-1 ml-1">V8.0</span></h1>
                    </div>
                    <nav className="flex-1 py-4 space-y-1 overflow-y-auto mt-16 lg:mt-0">
                        <NavItem icon={<LayoutDashboard size={20}/>} label="Vis√£o Geral" href="index.html" />
                        <NavItem icon={<ShoppingCart size={20}/>} label="Caixa (PDV)" href="pos.html" active={true} />
                        <NavItem icon={<Package size={20}/>} label="Expedi√ß√£o" href="expedition.html" />
                        <NavItem icon={<Truck size={20}/>} label="Log√≠stica" href="logistics.html" />
                        <NavItem icon={<Database size={20}/>} label="Cadastros" href="registry.html" />
                        <NavItem icon={<LineChart size={20}/>} label="Intelig√™ncia (BI)" href="intelligence.html" />
                        <NavItem icon={<HeartHandshake size={20}/>} label="P√≥s-Venda" href="postsale.html" />
                    </nav>
                    <div className="p-4 border-t border-slate-800 space-y-3 pb-8 lg:pb-4">
                        <button onClick={() => {setShowStockManager(true); setMobileMenuOpen(false);}} className="w-full flex items-center justify-start gap-3 p-2 rounded hover:bg-slate-800 transition text-slate-400 hover:text-white"><ClipboardList size={20} /> <span className="text-sm font-medium">Estoque R√°pido</span></button>
                    </div>
                </aside>
                <main className="flex-1 flex flex-col min-w-0 bg-gray-50 h-full overflow-hidden relative">
                    <header className="h-16 bg-white border-b hidden lg:flex items-center justify-between px-6 shrink-0 shadow-sm z-20"><div><h2 className="text-xl font-bold text-slate-800 flex items-center gap-2">Ponto de Venda</h2></div><div className="w-8 h-8 bg-slate-200 rounded-full flex items-center justify-center text-slate-600 font-bold">OP</div></header>
                    <div className="flex-1 overflow-y-auto overflow-x-hidden relative bg-gray-50">
                        <POSView clients={clients} products={products} setProducts={setProducts} sales={sales} setSales={setSales} saleToEdit={saleToEdit} setSaleToEdit={setSaleToEdit} />
                    </div>
                </main>
                {showStockManager && <div className="fixed inset-0 bg-black/80 z-[60] flex items-center justify-center p-4 animate-in"><div className="bg-white w-full max-w-5xl h-[85vh] rounded-xl shadow-2xl flex flex-col overflow-hidden"><div className="bg-slate-800 text-white p-4 flex justify-between items-center shrink-0"><h2 className="font-bold flex items-center gap-2 text-lg"><ClipboardList size={20}/> GERENCIADOR DE ESTOQUE</h2><button onClick={() => setShowStockManager(false)} className="hover:bg-slate-700 p-1.5 rounded-full transition"><XCircle size={24}/></button></div><StockManager products={products} setProducts={setProducts} /></div></div>}
                {mobileMenuOpen && <div className="fixed inset-0 bg-black/50 z-30 lg:hidden" onClick={() => setMobileMenuOpen(false)}></div>}
            </div>
          );
        }
        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
