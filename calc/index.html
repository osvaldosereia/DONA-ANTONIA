<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
    
    <!-- SEO & META INFO -->
    <title>Dona Antônia | Cestas Básicas e Alimentos em Cuiabá</title>
    <meta name="description" content="Monte sua cesta básica online com a Dona Antônia. Produtos de qualidade, preços baixos e entrega rápida em Cuiabá e Várzea Grande. Personalize agora!">
    <meta name="keywords" content="cesta básica, alimentos, supermercado online, cuiabá, várzea grande, dona antônia, compras">
    <meta name="author" content="Dona Antônia Alimentos">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#ffffff">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Dona Antônia | Cestas Básicas em Cuiabá">
    <meta property="og:description" content="Personalize sua cesta básica online. Qualidade e economia entregues na sua porta.">
    <meta property="og:image" content="img/og-image.jpg"> <!-- Substitua por uma imagem real -->

    <style>
        /* * ⚡ ULTRA-PERFORMANCE CSS 
         * Mobile-First | System Fonts | GPU Accelerated
         */
        :root {
            --primary: #dc2626;
            --primary-dark: #b91c1c;
            --text: #1e293b;
            --text-light: #64748b;
            --bg: #f8fafc;
            --surface: #ffffff;
            --border: #e2e8f0;
            --success: #16a34a;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            --font-main: system-ui, -apple-system, sans-serif;
            --nav-height: 64px;
        }

        /* RESET MÍNIMO */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: var(--font-main);
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.5;
            text-rendering: optimizeLegibility;
            padding-top: var(--nav-height);
            padding-bottom: 80px; /* Espaço footer mobile */
        }

        img { display: block; max-width: 100%; height: auto; object-fit: cover; background-color: #f1f5f9; }
        a { color: inherit; text-decoration: none; }
        
        /* LAYOUT UTILS */
        .container { width: 100%; max-width: 1100px; margin: 0 auto; padding: 0 16px; }
        .grid { display: grid; gap: 20px; }
        .flex { display: flex; align-items: center; }
        .flex-col { display: flex; flex-direction: column; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .gap-2 { gap: 8px; }
        .gap-4 { gap: 16px; }
        .hidden { display: none !important; }

        /* HEADER */
        header {
            position: fixed; top: 0; left: 0; width: 100%; height: var(--nav-height);
            background: rgba(255,255,255,0.98); backdrop-filter: blur(8px);
            border-bottom: 1px solid var(--border); z-index: 100;
            display: flex; align-items: center;
            will-change: transform; transition: transform 0.3s;
        }
        body.scroll-down header { transform: translateY(-100%); }

        .logo { font-weight: 800; font-size: 1.25rem; color: var(--text); display: flex; align-items: center; gap: 10px; }
        .badge { background: #f1f5f9; font-size: 0.75rem; padding: 4px 10px; border-radius: 20px; font-weight: 600; white-space: nowrap; }

        /* BUTTONS */
        button {
            cursor: pointer; border: none; font: inherit; font-weight: 600;
            display: inline-flex; justify-content: center; align-items: center; gap: 8px;
            padding: 0 16px; height: 44px; border-radius: 8px; 
            transition: opacity 0.2s, transform 0.1s;
        }
        button:active { transform: scale(0.98); }
        
        button.primary { background: var(--text); color: white; width: 100%; border-radius: 50px; }
        button.secondary { background: white; border: 2px solid var(--border); color: var(--text); width: 100%; border-radius: 50px; }
        button.secondary:hover { border-color: var(--text); }
        button.icon { width: 40px; height: 40px; padding: 0; border-radius: 50%; background: white; border: 1px solid var(--border); color: var(--text); }
        button.add-sm { height: 32px; padding: 0 14px; font-size: 0.8rem; border: 1px solid var(--border); background: white; border-radius: 6px; }
        
        /* BUSCA (STICKY TOP) */
        .search-sticky-wrapper {
            position: sticky; top: var(--nav-height); 
            background: var(--bg); padding: 10px 0; z-index: 50;
            margin-bottom: 10px;
        }
        input[type="search"] {
            width: 100%; height: 48px; padding: 0 16px 0 44px;
            border: 1px solid var(--border); border-radius: 50px;
            font-size: 1rem; background: white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394a3b8' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'%3E%3C/path%3E%3C/svg%3E") no-repeat 14px center/20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }

        /* CARDS (HOME) - DESKTOP FIXED */
        .card-basket {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: var(--radius); overflow: hidden;
            display: flex; flex-direction: column;
            transition: transform 0.2s;
            height: 100%; /* Garante altura total */
        }
        .img-wrapper { 
            aspect-ratio: 1/1; /* Quadrada sempre */
            width: 100%; position: relative; overflow: hidden;
            border-bottom: 1px solid var(--border);
        }
        .card-content { 
            padding: 16px; flex: 1; display: flex; flex-direction: column; 
            justify-content: space-between; gap: 12px;
        }
        .card-title { font-size: 1.1rem; font-weight: 700; line-height: 1.3; }
        .price-tag { font-size: 1.4rem; font-weight: 800; color: var(--primary); letter-spacing: -0.5px; }
        
        /* Botoes do card em Grid para alinhar */
        .card-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: auto; }
        .card-actions button { font-size: 0.9rem; padding: 0 8px; }

        /* LISTA CUSTOMIZER - MOBILE OTIMIZADO */
        .list-item {
            display: grid; 
            grid-template-columns: 80px 1fr; 
            gap: 12px;
            padding: 12px; background: white; border-bottom: 1px solid var(--border);
            align-items: start;
        }
        .list-item:last-child { border-bottom: none; }
        
        .thumb { 
            width: 80px; height: 80px; border-radius: 8px; 
            object-fit: contain; padding: 0; cursor: zoom-in;
            background: white; border: 1px solid #f1f5f9;
        }
        
        .item-content {
            display: flex; flex-direction: column; justify-content: space-between;
            min-height: 80px; width: 100%;
        }

        .item-info h3 { 
            font-size: 0.9rem; font-weight: 600; line-height: 1.3; margin-bottom: 4px; 
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; 
        }
        
        .item-bottom {
            display: flex; align-items: center; justify-content: space-between;
            width: 100%; margin-top: auto;
        }

        .item-meta { font-size: 0.95rem; color: var(--text-light); font-weight: 500; }
        
        .qty-ctrl {
            display: flex; align-items: center; background: white;
            border: 1px solid var(--border); border-radius: 6px; height: 32px;
        }
        .qty-ctrl button { width: 30px; height: 100%; padding: 0; background: none; color: var(--text); font-size: 1.1rem; border-radius: 0; }
        .qty-ctrl span { min-width: 24px; text-align: center; font-weight: 600; font-size: 0.9rem; }

        /* CHECKOUT BAR & CREDIT PILL */
        .float-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(255,255,255,0.98); border-top: 1px solid var(--border);
            padding: 12px 16px; backdrop-filter: blur(10px); z-index: 90;
            padding-bottom: max(12px, env(safe-area-inset-bottom));
            display: flex; align-items: center; justify-content: space-between; gap: 16px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
        }
        .credit-pill {
            position: absolute; top: -50px; left: 50%; transform: translateX(-50%) translateY(20px);
            background: var(--text); color: white; padding: 8px 20px; border-radius: 30px;
            font-size: 0.85rem; font-weight: 600; opacity: 0; pointer-events: none;
            transition: all 0.3s; white-space: nowrap; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .credit-pill.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        .total-box div { font-size: 1.4rem; font-weight: 800; color: var(--primary); line-height: 1; }
        .btn-checkout { background: var(--success); color: white; flex: 1; max-width: 200px; border-radius: 50px; }

        /* FLOATING ACTIONS (MOBILE) */
        .floating-actions {
            position: fixed; bottom: 100px; right: 16px; z-index: 95;
            display: flex; flex-direction: column; gap: 12px;
        }
        .btn-float {
            width: 48px; height: 48px; border-radius: 50%;
            background: white; border: 1px solid var(--border);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); color: var(--text);
            display: flex; align-items: center; justify-content: center;
            padding: 0; /* Importante para o ícone centralizar */
        }
        .btn-float svg { width: 24px; height: 24px; } /* Força tamanho do ícone */

        /* BOTTOM SHEET */
        .bottom-sheet-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 200;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .bottom-sheet-overlay.open { opacity: 1; pointer-events: auto; }
        
        .bottom-sheet {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: white; border-radius: 20px 20px 0 0;
            max-height: 70vh; overflow-y: auto;
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            padding-bottom: 30px;
            box-shadow: 0 -5px 25px rgba(0,0,0,0.1);
        }
        .bottom-sheet-overlay.open .bottom-sheet { transform: translateY(0); }
        .sheet-handle { width: 40px; height: 4px; background: #e2e8f0; border-radius: 10px; margin: 12px auto; }

        /* MODAIS */
        dialog {
            margin: auto; padding: 0; border: none; border-radius: 16px;
            width: 90%; max-width: 500px; box-shadow: 0 20px 50px rgba(0,0,0,0.25);
            background: white; overflow: hidden;
        }
        dialog::backdrop { background: rgba(0,0,0,0.7); backdrop-filter: blur(2px); }
        .modal-head { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; font-weight: 700; }
        .modal-body { padding: 20px; max-height: 70vh; overflow-y: auto; }

        /* OPCOES DE PAGAMENTO */
        .payment-options { display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }
        .pay-opt {
            display: flex; align-items: center; gap: 12px;
            padding: 12px; border: 1px solid var(--border); border-radius: 8px;
            cursor: pointer;
        }
        .pay-opt:has(input:checked) { border-color: var(--success); background: #f0fdf4; }
        .pay-opt input { width: 18px; height: 18px; accent-color: var(--success); }

        /* GALERIA MODAL */
        dialog#gallery-modal {
            max-width: 100%; width: 100%; height: 100%; 
            background: black; border-radius: 0; padding: 0;
        }
        #gallery-modal .modal-body { 
            height: 100%; display: flex; flex-direction: column; justify-content: center; padding: 0; 
        }
        .gallery-stage { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; }
        .gallery-stage img { max-height: 80vh; max-width: 100%; object-fit: contain; aspect-ratio: 1/1; }
        .gallery-thumbs { display: flex; gap: 10px; padding: 20px; overflow-x: auto; justify-content: center; background: rgba(0,0,0,0.5); position: absolute; bottom: 0; width: 100%; }
        .g-thumb { width: 60px; height: 60px; border-radius: 4px; border: 2px solid transparent; opacity: 0.6; object-fit: cover; }
        .g-thumb.active { border-color: white; opacity: 1; }
        .close-gallery { position: absolute; top: 20px; right: 20px; z-index: 10; background: rgba(255,255,255,0.2); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; }

        /* TOAST */
        .toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px);
            background: #ef4444; color: white; padding: 10px 24px; border-radius: 50px;
            z-index: 200; font-weight: 600; font-size: 0.9rem; transition: transform 0.3s;
        }
        .toast.show { transform: translateX(-50%) translateY(0); }

        /* SIDEBAR NAV (DESKTOP) */
        .sidebar-nav { display: none; background: white; border: 1px solid var(--border); border-radius: var(--radius); padding: 16px; position: sticky; top: 100px; max-height: 80vh; overflow-y: auto; }
        .sn-link { display: block; padding: 6px 0; color: var(--text-light); font-size: 0.9rem; cursor: pointer; }
        .sn-link:hover { color: var(--primary); }
        .sn-title { font-weight: 700; font-size: 0.8rem; text-transform: uppercase; margin-bottom: 10px; color: var(--text); }

        /* FOOTER HOME */
        .footer-home {
            background: white; border-top: 1px solid var(--border);
            padding: 40px 0; margin-top: 40px; text-align: center;
        }
        .footer-grid { display: grid; gap: 30px; text-align: left; }
        .social-btn { 
            display: inline-flex; align-items: center; gap: 10px; padding: 10px 20px; 
            border-radius: 50px; font-weight: 700; margin-top: 10px; color: white;
        }
        .btn-zap { background: #25D366; }
        .btn-insta { background: #E1306C; }

        /* DESKTOP MEDIA QUERY */
        @media (min-width: 1024px) {
            .grid-cols-desktop { grid-template-columns: repeat(5, 1fr); gap: 24px; } /* 5 colunas */
            .item-info h3 { font-size: 1rem; }
            .img-wrapper { aspect-ratio: 1/1; } /* Quadrada Desktop */
            
            .customizer-layout { display: grid; grid-template-columns: 1fr 300px; gap: 40px; align-items: start; }
            .float-bar {
                position: sticky; top: 100px; bottom: auto; border: 1px solid var(--border);
                border-radius: var(--radius); flex-direction: column; align-items: stretch;
                padding: 24px; gap: 20px; z-index: 10;
            }
            .credit-pill { top: -60px; width: 100%; text-align: center; }
            .sidebar-nav { display: block; }
            .floating-actions { display: none; }

            /* Footer Desktop */
            .footer-grid { grid-template-columns: 1fr 1fr; }

            /* LISTA CUSTOMIZER DESKTOP ADJUSTS */
            .list-item { grid-template-columns: 80px 1fr auto; align-items: center; } 
            .item-content { flex-direction: row; align-items: center; justify-content: space-between; }
            .item-bottom { width: auto; gap: 20px; margin-top: 0; }
            .item-info h3 { margin-right: 20px; margin-bottom: 0; }
            
            /* GALERIA DESKTOP BONITA (CENTRALIZADA) */
            dialog#gallery-modal {
                width: auto; height: auto; 
                max-width: 900px; max-height: 85vh;
                background: white; border-radius: 16px;
                box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            }
            #gallery-modal .modal-body { padding: 20px; }
            .gallery-stage img { background: white; max-height: 60vh; border-radius: 8px; }
            .gallery-thumbs { position: static; background: white; padding: 10px 0 0 0; }
            .close-gallery { background: #f1f5f9; color: var(--text); top: 10px; right: 10px; }
            .close-gallery:hover { background: #e2e8f0; }
        }
    </style>
</head>
<body>

    <header>
        <div class="container flex justify-between">
            <a href="#" onclick="App.route('home')" class="logo">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:var(--primary)"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                Dona Antônia
            </a>
            <span class="badge">Cuiabá & VG</span>
        </div>
    </header>

    <div id="toast" class="toast">Limite atingido!</div>

    <!-- VIEW: HOME -->
    <main id="view-home" style="padding-top: 20px;">
        <div class="container">
            <div style="text-align: center; margin-bottom: 30px;">
                <h1 style="font-size: 1.8rem; font-weight: 800; color: var(--text); margin-bottom: 8px;">Escolha sua Cesta</h1>
                <p style="color: var(--text-light);">Qualidade e economia para sua família.</p>
            </div>
            
            <div id="basket-grid" class="grid grid-cols-desktop" style="padding-bottom: 40px;">
                <div style="grid-column: 1/-1; text-align: center; padding: 40px;">Carregando catálogo...</div>
            </div>
        </div>

        <!-- FOOTER INFO EMPRESA -->
        <footer class="footer-home">
            <div class="container footer-grid">
                <div>
                    <h3 style="font-size:1.2rem; margin-bottom:10px;">Dona Antônia Alimentos</h3>
                    <p style="color:var(--text-light); margin-bottom:20px;">
                        Levando alimentos de qualidade para a mesa das famílias em Cuiabá e Várzea Grande. 
                        Compromisso com o menor preço e entrega rápida.
                    </p>
                    <div class="flex flex-col" style="align-items:flex-start; gap:10px;">
                        <a href="https://wa.me/5565998150975" target="_blank" class="social-btn btn-zap">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.008-.57-.008-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                            Falar no WhatsApp
                        </a>
                        <a href="https://instagram.com" target="_blank" class="social-btn btn-insta">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
                            Instagram
                        </a>
                    </div>
                </div>
                <div>
                    <h4 style="font-weight:700; margin-bottom:10px;">Atendimento</h4>
                    <p style="color:var(--text-light); font-size:0.9rem;">
                        Segunda a Sábado: 07:00 às 18:00<br>
                        Entregas agendadas em toda a região.
                    </p>
                </div>
            </div>
        </footer>
    </main>

    <!-- VIEW: CUSTOMIZER -->
    <main id="view-customizer" class="container hidden" style="padding-top: 20px;">
        <div class="flex gap-2" style="margin-bottom: 20px;">
            <button class="icon" onclick="App.route('home')" aria-label="Voltar">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
            </button>
            <div>
                <h2 id="customizer-title" style="font-size: 1.2rem; font-weight: 700; line-height: 1.2;">Nome da Cesta</h2>
                <span id="customizer-subtitle" style="font-size: 0.85rem; color: var(--text-light);">Trocas: <span id="changes-count">0</span></span>
            </div>
        </div>

        <div class="customizer-layout">
            <!-- Coluna Esquerda: Listas -->
            <div>
                <!-- BUSCA STICKY -->
                <div class="search-sticky-wrapper">
                    <input type="search" id="search-input" placeholder="Buscar produto extra..." aria-label="Buscar produto">
                </div>

                <div style="margin-top: 10px;">
                    <h3 style="font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-light); margin-bottom: 12px;">Itens da Cesta</h3>
                    <div id="list-included" style="background: white; border-radius: var(--radius); border: 1px solid var(--border); overflow: hidden;"></div>
                </div>

                <div style="margin-top: 40px;">
                    <h3 style="font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-light); margin-bottom: 12px;">Adicionar Extras</h3>
                    <div id="list-extras" class="grid" style="gap: 0; background: white; border-radius: var(--radius); border: 1px solid var(--border); overflow: hidden;"></div>
                </div>
            </div>

            <!-- Coluna Direita (Desktop Sidebar + Checkout) -->
            <div>
                <!-- Menu Lateral Desktop -->
                <nav class="sidebar-nav" id="desktop-categories"></nav>

                <!-- Box Checkout -->
                <aside class="float-bar">
                    <div id="credit-pill" class="credit-pill"></div>
                    
                    <div class="total-box">
                        <small>Total Final</small>
                        <div id="total-display">R$ 0,00</div>
                    </div>
                    <button class="btn-checkout" onclick="App.checkout()">
                        Finalizar
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                    </button>
                </aside>
            </div>
        </div>
    </main>

    <!-- FLOATING ACTIONS (MOBILE) -->
    <div class="floating-actions">
        <button class="btn-float" onclick="App.openSheetMenu()" aria-label="Categorias">
            <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path></svg>
        </button>
        <button class="btn-float" onclick="window.scrollTo({top:0, behavior:'smooth'})" aria-label="Topo">
            <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>
        </button>
    </div>

    <!-- BOTTOM SHEET CATEGORIAS (MOBILE) -->
    <div id="sheet-menu-overlay" class="bottom-sheet-overlay" onclick="App.closeSheetMenu()">
        <div class="bottom-sheet" onclick="event.stopPropagation()">
            <div class="sheet-handle"></div>
            <div style="padding: 0 20px;">
                <h3 style="margin-bottom: 15px; font-size: 1.1rem; color: var(--text);">Categorias</h3>
                <div id="mobile-categories-list"></div>
            </div>
        </div>
    </div>

    <!-- MODAL GALERIA -->
    <dialog id="gallery-modal">
        <button class="close-gallery" onclick="this.closest('dialog').close()">✕</button>
        <div class="modal-body">
            <div class="gallery-stage">
                <img id="gallery-main-img" src="" alt="Zoom">
            </div>
            <div class="gallery-thumbs" id="gallery-thumbs"></div>
        </div>
    </dialog>

    <!-- MODAL CHECKOUT -->
    <dialog id="modal-checkout">
        <div class="modal-head">
            <span>Resumo do Pedido</span>
            <button class="icon" onclick="this.closest('dialog').close()">✕</button>
        </div>
        <div class="modal-body">
            <div id="checkout-list" style="margin-bottom: 20px; font-size: 0.9rem;"></div>
            
            <div style="border-top: 1px dashed var(--border); padding-top: 15px; margin-top: 15px;">
                <p style="font-weight: 600; margin-bottom: 10px;">Forma de Pagamento:</p>
                <div class="payment-options">
                    <label class="pay-opt"><input type="radio" name="payment" value="Pix" checked> Pix</label>
                    <label class="pay-opt"><input type="radio" name="payment" value="Dinheiro"> Dinheiro</label>
                    <label class="pay-opt"><input type="radio" name="payment" value="Cartão de Débito"> Cartão de Débito</label>
                    <label class="pay-opt"><input type="radio" name="payment" value="Cartão de Crédito"> Cartão de Crédito</label>
                    <label class="pay-opt"><input type="radio" name="payment" value="Vale Alimentação"> Vale Alimentação</label>
                    <label class="pay-opt"><input type="radio" name="payment" value="Vale Refeição"> Vale Refeição</label>
                </div>
            </div>

            <button class="primary" onclick="App.sendWhatsapp()" style="margin-top: 24px; background: #25D366; border:none;">
                Enviar no WhatsApp
            </button>
        </div>
    </dialog>

    <script>
        const BASKET_LIMITS = {
            'economica': 5, 'econômica': 5,
            'pequena': 9, 'média': 11, 'media': 11, 'grande': 13,
            'familia': 15, 'família': 15
        };

        const App = {
            data: [],
            cart: {},
            originalCart: {}, 
            currentBasket: null,
            currentLimit: 99,
            basePrice: 0,
            
            async init() {
                try {
                    const res = await fetch('./produtos/produtos.json');
                    if (!res.ok) throw new Error("JSON not found");
                    this.data = await res.json();
                } catch (e) {
                    // Fallback
                    this.data = [
                        {id: "c1", nome: "Cesta Econômica", categoria: "CESTA BÁSICA", valor: 150.00, imagem: "img/cesta1.jpg", items: [{id:"p1", qtd:1}, {id:"p2", qtd:2}]},
                        {id: "p1", nome: "Arroz 5kg", categoria: "ALIMENTOS", valor: 22.90, imagem: "img/arroz.jpg"},
                        {id: "p2", nome: "Feijão 1kg", categoria: "ALIMENTOS", valor: 8.50, imagem: "img/feijao.jpg"},
                        {id: "p3", nome: "Óleo 900ml", categoria: "ALIMENTOS", valor: 6.90, imagem: "img/oleo.jpg"}
                    ];
                }
                
                this.data = this.data.map(p => ({
                    ...p,
                    valor: parseFloat(p.valor || 0),
                    items: p.items || []
                }));

                this.renderHome();
                
                let lastScroll = 0;
                window.addEventListener('scroll', () => {
                    const current = window.scrollY;
                    if (current > 50 && current > lastScroll) document.body.classList.add('scroll-down');
                    else document.body.classList.remove('scroll-down');
                    lastScroll = current;
                }, {passive: true});

                document.getElementById('search-input').addEventListener('input', (e) => {
                    this.renderExtras(e.target.value.toLowerCase());
                });
            },

            route(viewName) {
                if (viewName === 'home') {
                    document.getElementById('view-customizer').classList.add('hidden');
                    document.getElementById('view-home').classList.remove('hidden');
                    window.scrollTo(0,0);
                } else {
                    document.getElementById('view-home').classList.add('hidden');
                    document.getElementById('view-customizer').classList.remove('hidden');
                    window.scrollTo(0,0);
                }
            },

            renderHome() {
                const cestas = this.data.filter(p => p.categoria.includes('CESTA'));
                const grid = document.getElementById('basket-grid');
                
                grid.innerHTML = cestas.map((c, index) => `
                    <article class="card-basket">
                        <div class="img-wrapper">
                            <img src="${c.imagem}" alt="${c.nome}" loading="${index===0?'eager':'lazy'}"
                                 onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 1 1\' fill=\'%23e2e8f0\'%3E%3C/svg%3E'">
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">${c.nome}</h3>
                            <div class="price-tag">R$ ${c.valor.toFixed(2).replace('.', ',')}</div>
                            <div class="card-actions">
                                <button class="primary" onclick="App.openCustomizer('${c.id}')">Personalizar</button>
                                <button class="secondary" onclick="App.quickCheckout('${c.id}')">Encomendar</button>
                            </div>
                        </div>
                    </article>
                `).join('');
            },

            openCustomizer(id) {
                const cesta = this.data.find(c => c.id == id);
                if (!cesta) return;

                this.currentBasket = cesta;
                this.cart = {};
                this.originalCart = {}; 
                
                const nameKey = cesta.nome.toLowerCase().replace('cesta ', '').trim();
                this.currentLimit = BASKET_LIMITS[nameKey] || 99;

                let itemsValue = 0;
                cesta.items.forEach(item => {
                    let prod = this.data.find(p => p.id == item.id);
                    if (!prod) prod = this.data.find(p => p.nome === item.nome && !p.categoria.includes('CESTA'));
                    
                    if (prod) {
                        const qtd = item.qtd || 1;
                        this.cart[prod.id] = (this.cart[prod.id] || 0) + qtd;
                        itemsValue += prod.valor * qtd;
                    }
                });
                
                this.originalCart = {...this.cart}; 
                this.basePrice = Math.max(0, cesta.valor - itemsValue);

                document.getElementById('customizer-title').innerText = cesta.nome;
                document.getElementById('search-input').value = '';
                
                this.renderIncluded();
                this.renderExtras();
                this.updateTotal();
                this.route('customizer');
            },

            renderIncluded() {
                const container = document.getElementById('list-included');
                const ids = Object.keys(this.cart);
                
                if (ids.length === 0) {
                    container.innerHTML = '<div style="padding:20px; text-align:center; color:var(--text-light)">Nenhum item.</div>';
                    return;
                }
                container.innerHTML = ids.map(id => {
                    const p = this.data.find(x => x.id == id);
                    if (!p) return '';
                    return this.createRowHTML(p, this.cart[id], true);
                }).join('');
            },

            renderExtras(term = '') {
                const container = document.getElementById('list-extras');
                const navDesktop = document.getElementById('desktop-categories');
                const navMobile = document.getElementById('mobile-categories-list');

                const extras = this.data.filter(p => 
                    !p.categoria.includes('CESTA') && 
                    (!term || p.nome.toLowerCase().includes(term))
                ).slice(0, 60);

                if (extras.length === 0) {
                    container.innerHTML = '<div style="padding:20px; text-align:center;">Nenhum produto.</div>';
                    return;
                }

                const grouped = {};
                extras.forEach(p => {
                    const cat = p.categoria || 'OUTROS';
                    if(!grouped[cat]) grouped[cat] = [];
                    grouped[cat].push(p);
                });

                let html = '';
                let navHtml = '<div class="sn-title">Categorias</div>';
                
                for (const [cat, products] of Object.entries(grouped)) {
                    const anchor = `cat-${cat.replace(/\s/g, '-')}`;
                    const scrollFn = `document.getElementById('${anchor}').scrollIntoView({behavior:'smooth'}); App.closeSheetMenu();`;
                    
                    navHtml += `<a class="sn-link" onclick="${scrollFn}">${cat}</a>`;
                    
                    html += `<div id="${anchor}" style="background:#f8fafc; padding:10px 16px; font-weight:700; font-size:0.8rem; color:var(--text-light); border-bottom:1px solid var(--border); margin-top:20px;">${cat}</div>`;
                    html += products.map(p => this.createRowHTML(p, this.cart[p.id] || 0, false)).join('');
                }
                
                container.innerHTML = html;
                if (!term) {
                    navDesktop.innerHTML = navHtml;
                    navMobile.innerHTML = navHtml.replace(/sn-link/g, 'sn-link style="padding:12px; border-bottom:1px solid #eee; font-size:1rem;"').replace(/sn-title/g, 'hidden');
                }
            },

            createRowHTML(p, qtd, isIncludedSection) {
                if (isIncludedSection && qtd === 0) return '';
                const clickAction = `App.openGallery('${p.id}')`;
                
                return `
                <div class="list-item">
                    <img src="${p.imagem}" class="thumb" loading="lazy" onclick="${clickAction}"
                         onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 1 1\' fill=\'%23f1f5f9\'%3E%3C/svg%3E'">
                    
                    <div class="item-content">
                        <div class="item-info">
                            <h3>${p.nome}</h3>
                        </div>
                        <div class="item-bottom">
                            <div class="item-meta">R$ ${p.valor.toFixed(2).replace('.', ',')}</div>
                            ${qtd === 0 && !isIncludedSection 
                                ? `<button class="add-sm" onclick="App.changeQty('${p.id}', 1)">Adicionar</button>`
                                : `<div class="qty-ctrl">
                                    <button onclick="App.changeQty('${p.id}', -1)">-</button>
                                    <span>${qtd}</span>
                                    <button onclick="App.changeQty('${p.id}', 1)">+</button>
                                </div>`
                            }
                        </div>
                    </div>
                </div>`;
            },

            changeQty(id, delta) {
                if (delta < 0 && this.originalCart[id]) {
                    const simulatedCart = {...this.cart};
                    simulatedCart[id] = (simulatedCart[id] || 0) + delta;
                    if (simulatedCart[id] <= 0) {
                        let removals = 0;
                        for(let k in this.originalCart) {
                            if (this.originalCart[k] > 0 && (!simulatedCart[k] || simulatedCart[k] <= 0)) removals++;
                        }
                        if (removals > this.currentLimit) {
                            this.showToast(`Limite de ${this.currentLimit} trocas!`);
                            return;
                        }
                    }
                }

                if (!this.cart[id]) this.cart[id] = 0;
                this.cart[id] += delta;
                if (this.cart[id] <= 0) delete this.cart[id];

                this.renderIncluded();
                this.updateTotal();
            },

            updateTotal() {
                let totalItems = 0;
                for (const [id, qtd] of Object.entries(this.cart)) {
                    const p = this.data.find(x => x.id == id);
                    if (p) totalItems += p.valor * qtd;
                }
                
                const calcTotal = totalItems + this.basePrice;
                const finalTotal = Math.max(calcTotal, this.currentBasket.valor);
                
                const pill = document.getElementById('credit-pill');
                if (calcTotal < this.currentBasket.valor) {
                    const credit = this.currentBasket.valor - calcTotal;
                    if (credit > 3) { 
                        pill.innerHTML = `Você tem <b>R$ ${credit.toFixed(2).replace('.', ',')}</b> de crédito!`;
                        pill.classList.add('show');
                    } else {
                        pill.classList.remove('show');
                    }
                } else {
                    pill.classList.remove('show');
                }

                const removals = this.calculateRemovals();
                document.getElementById('changes-count').innerText = `${removals}/${this.currentLimit}`;
                document.getElementById('total-display').innerText = `R$ ${finalTotal.toFixed(2).replace('.', ',')}`;
            },

            calculateRemovals() {
                let removals = 0;
                for (let k in this.originalCart) {
                    if (this.originalCart[k] > 0 && (!this.cart[k] || this.cart[k] <= 0)) removals++;
                }
                return removals;
            },

            quickCheckout(basketId) {
                const cesta = this.data.find(c => c.id == basketId);
                if (!cesta) return;
                this.currentBasket = cesta;
                this.cart = {};
                this.basePrice = 0;
                let itemsValue = 0;
                cesta.items.forEach(item => {
                    let prod = this.data.find(p => p.id == item.id) || this.data.find(p => p.nome === item.nome);
                    if (prod) {
                        this.cart[prod.id] = (item.qtd || 1);
                        itemsValue += prod.valor * (item.qtd || 1);
                    }
                });
                this.basePrice = Math.max(0, cesta.valor - itemsValue);
                this.checkout();
            },

            checkout() {
                if (Object.keys(this.cart).length === 0) {
                    this.showToast("Cesta vazia!");
                    return;
                }
                
                const listEl = document.getElementById('checkout-list');
                let html = '<ul style="list-style:none;">';
                let total = 0;

                for (const [id, qtd] of Object.entries(this.cart)) {
                    const p = this.data.find(x => x.id == id);
                    if (p) {
                        const sub = p.valor * qtd;
                        total += sub;
                        html += `<li class="flex justify-between" style="margin-bottom:8px; border-bottom:1px solid #f1f5f9; padding-bottom:8px;">
                            <span>${qtd}x ${p.nome}</span>
                            <b>R$ ${sub.toFixed(2).replace('.', ',')}</b>
                        </li>`;
                    }
                }
                
                const finalTotal = Math.max(total + this.basePrice, this.currentBasket.valor);
                
                html += `</ul>
                <div class="flex justify-between" style="margin-top:15px; font-size:1.1rem; color:var(--primary); font-weight:800;">
                    <span>TOTAL</span>
                    <span>R$ ${finalTotal.toFixed(2).replace('.', ',')}</span>
                </div>`;

                listEl.innerHTML = html;
                document.getElementById('modal-checkout').showModal();
            },

            openGallery(prodId) {
                const p = this.data.find(x => x.id == prodId);
                if(!p) return;

                const modal = document.getElementById('gallery-modal');
                const mainImg = document.getElementById('gallery-main-img');
                const thumbsContainer = document.getElementById('gallery-thumbs');

                mainImg.src = p.imagem;
                
                const baseName = p.imagem.replace(/(\.[^.]+)$/, '');
                const ext = p.imagem.match(/(\.[^.]+)$/)[0];
                
                const attempts = [p.imagem, `${baseName}A${ext}`, `${baseName}B${ext}`];
                
                thumbsContainer.innerHTML = '';
                attempts.forEach(src => {
                    const img = new Image();
                    img.src = src;
                    img.onload = () => {
                        const thumb = document.createElement('img');
                        thumb.src = src;
                        thumb.className = 'g-thumb';
                        thumb.onclick = () => {
                            mainImg.src = src;
                            document.querySelectorAll('.g-thumb').forEach(t => t.classList.remove('active'));
                            thumb.classList.add('active');
                        };
                        thumbsContainer.appendChild(thumb);
                    };
                });
                
                modal.showModal();
            },

            openSheetMenu() {
                document.getElementById('sheet-menu-overlay').classList.add('open');
            },

            closeSheetMenu() {
                document.getElementById('sheet-menu-overlay').classList.remove('open');
            },

            sendWhatsapp() {
                const payment = document.querySelector('input[name="payment"]:checked').value;
                let msg = `*PEDIDO: ${this.currentBasket.nome}*\n------------------\n`;
                let total = 0;
                for (const [id, qtd] of Object.entries(this.cart)) {
                    const p = this.data.find(x => x.id == id);
                    if (p) {
                        total += p.valor * qtd;
                        msg += `${qtd}x ${p.nome}\n`;
                    }
                }
                const finalTotal = Math.max(total + this.basePrice, this.currentBasket.valor);
                msg += `------------------\n*TOTAL: R$ ${finalTotal.toFixed(2).replace('.', ',')}*\n`;
                msg += `Pagamento: ${payment}`;
                window.open(`https://api.whatsapp.com/send?phone=5565998150975&text=${encodeURIComponent(msg)}`, '_blank');
            },

            showToast(msg) {
                const t = document.getElementById('toast');
                t.innerText = msg;
                t.classList.add('show');
                setTimeout(() => t.classList.remove('show'), 3000);
            }
        };

        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>
