<!DOCTYPE html>
<html lang="pt-br" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Monte sua Cesta | Dona Ant√¥nia</title>
    <meta name="description" content="Monte sua cesta b√°sica personalizada em Cuiab√°. Entrega Gr√°tis.">
    <meta name="theme-color" content="#0F2546">

    <!-- Tailwind CSS (Estiliza√ß√£o Moderna) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configura√ß√£o do Tailwind para as cores da marca -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            dark: '#0F2546', // Azul Marinho
                            red: '#D32F2F',  // Vermelho
                            gold: '#FFC107', // Dourado
                            whatsapp: '#25D366',
                            bg: '#f3f4f6'
                        }
                    }
                }
            }
        }
    </script>
    <!-- √çcones Leves -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Ajustes finos que o Tailwind n√£o cobre nativamente */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .product-img { aspect-ratio: 1/1; object-fit: contain; mix-blend-mode: multiply; }
        /* Anima√ß√£o do Toast */
        @keyframes slideIn { from { transform: translateX(-50%) translateY(100%); opacity: 0; } to { transform: translateX(-50%) translateY(0); opacity: 1; } }
        .toast-anim { animation: slideIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    </style>
</head>
<body class="bg-brand-bg text-gray-800 pb-32">

    <!-- TOAST CONTAINER -->
    <div id="toast-container" class="fixed bottom-24 left-1/2 z-[9999] w-max max-w-[90%] pointer-events-none"></div>

    <!-- HEADER -->
    <header class="fixed top-0 w-full bg-white shadow-md z-50 h-16 flex items-center justify-between px-4 lg:px-8 max-w-5xl mx-auto left-0 right-0">
        <div class="flex items-center gap-3">
            <div class="relative w-12 h-12 bg-white rounded-full shadow-lg flex items-center justify-center overflow-hidden border border-gray-100">
                <!-- Fallback inteligente para logo -->
                <img src="img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif" 
                     onerror="this.onerror=null; this.src='https://placehold.co/100x100/0F2546/FFF?text=DA'; this.parentElement.classList.add('p-0')" 
                     class="w-full h-full object-cover" alt="Logo">
            </div>
            <h1 class="hidden sm:block font-bold text-brand-dark text-lg leading-tight">
                Dona Ant√¥nia <br><span class="text-xs text-brand-gold font-normal uppercase tracking-wider">Alimentos</span>
            </h1>
        </div>

        <button onclick="App.actions.openContact()" class="bg-brand-dark text-brand-gold border border-brand-gold px-4 py-2 rounded-full text-sm font-bold flex items-center gap-2 shadow-lg active:scale-95 transition-transform">
            <i class="fab fa-whatsapp text-lg"></i>
            <span>FALE CONOSCO</span>
        </button>
    </header>

    <!-- MAIN CONTENT -->
    <main class="pt-24 px-4 max-w-5xl mx-auto w-full">
        
        <!-- Hero / SEO -->
        <div class="text-center mb-6">
            <h2 class="text-2xl font-bold text-brand-dark">Monte sua Cesta</h2>
            <p class="text-gray-500 text-sm mt-1">Escolha os itens e receba em casa com frete gr√°tis.</p>
        </div>

        <!-- Regras (Card Informativo) -->
        <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6 flex items-start gap-3 shadow-sm">
            <div class="bg-blue-100 p-2 rounded-full text-blue-600 shrink-0">
                <i class="fas fa-shopping-basket"></i>
            </div>
            <div class="text-sm text-blue-900">
                <p class="font-bold mb-1">Regras da Cesta:</p>
                <ul class="list-disc pl-4 space-y-1 text-blue-800">
                    <li>M√≠nimo de <strong>10 produtos diferentes</strong>.</li>
                    <li>M√≠nimo de <strong>20 itens no total</strong>.</li>
                </ul>
            </div>
        </div>

        <!-- Grid de Produtos -->
        <div id="app-root" class="space-y-8">
            <!-- O conte√∫do ser√° injetado aqui pelo JS -->
            <div class="flex justify-center p-10"><i class="fas fa-spinner fa-spin text-3xl text-brand-dark"></i></div>
        </div>

        <!-- Informa√ß√µes Extras (Pagamento/Entrega) -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-8 mb-4">
            <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 text-center">
                <i class="fas fa-credit-card text-brand-dark text-2xl mb-2"></i>
                <h3 class="font-bold text-gray-700">Pagamento</h3>
                <p class="text-xs text-gray-500 mt-1">Dinheiro, Pix, Cart√µes e Vale Alimenta√ß√£o (Alelo, Sodexo, Pluxee).</p>
            </div>
            <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 text-center">
                <i class="fas fa-truck text-orange-500 text-2xl mb-2"></i>
                <h3 class="font-bold text-gray-700">Entrega Gr√°tis</h3>
                <p class="text-xs text-gray-500 mt-1">Cuiab√° e V√°rzea Grande - MT</p>
            </div>
        </div>

        <footer class="text-center text-gray-400 text-xs py-6">
            ¬© 2025 Dona Ant√¥nia Alimentos. Todos os direitos reservados.
        </footer>
    </main>

    <!-- BARRA FLUTUANTE (Bottom Sheet) -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-[0_-5px_20px_rgba(0,0,0,0.1)] z-40 pb-safe">
        <div class="max-w-5xl mx-auto">
            
            <!-- Barra de Progresso (Gamifica√ß√£o) -->
            <div class="grid grid-cols-2 gap-4 px-4 py-2 bg-gray-50 border-b border-gray-100 text-xs font-bold uppercase tracking-wider text-gray-500">
                <div>
                    <div class="flex justify-between mb-1">
                        <span>Diversidade <span id="ui-dif-count">0/10</span></span>
                        <i id="ui-dif-check" class="fas fa-check-circle text-gray-300"></i>
                    </div>
                    <div class="h-1.5 w-full bg-gray-200 rounded-full overflow-hidden">
                        <div id="ui-dif-bar" class="h-full bg-brand-gold transition-all duration-500 w-0"></div>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between mb-1">
                        <span>Quantidade <span id="ui-total-count">0/20</span></span>
                        <i id="ui-total-check" class="fas fa-check-circle text-gray-300"></i>
                    </div>
                    <div class="h-1.5 w-full bg-gray-200 rounded-full overflow-hidden">
                        <div id="ui-total-bar" class="h-full bg-brand-gold transition-all duration-500 w-0"></div>
                    </div>
                </div>
            </div>

            <!-- Controles -->
            <div class="p-3 flex items-center justify-between gap-3">
                <div class="flex flex-col">
                    <span class="text-xs text-gray-500 font-medium">Total Estimado</span>
                    <span id="ui-total-price" class="text-xl font-extrabold text-brand-dark">R$ 0,00</span>
                </div>

                <div class="flex gap-2">
                    <button onclick="App.actions.toggleHistory()" class="bg-blue-100 text-blue-700 w-12 h-12 rounded-xl flex items-center justify-center hover:bg-blue-200 transition-colors" title="Hist√≥rico">
                        <i class="fas fa-history"></i>
                    </button>
                    <button id="btn-encomendar" onclick="App.actions.checkout()" disabled class="flex-1 bg-gray-300 text-gray-500 px-6 py-2 rounded-xl font-bold flex items-center gap-2 transition-all disabled:cursor-not-allowed">
                        <span>ENCOMENDAR</span>
                        <i class="fab fa-whatsapp"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAIS (Hist√≥rico e Contato) -->
    <!-- Modal gen√©rico controlado por JS -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-4 opacity-0 transition-opacity duration-300" onclick="if(event.target === this) App.ui.closeModal()">
        <div class="bg-white w-full max-w-sm rounded-2xl shadow-2xl transform scale-95 transition-transform duration-300 overflow-hidden" id="modal-content">
            <!-- Conte√∫do injetado via JS -->
        </div>
    </div>

    <!-- L√ìGICA DA APLICA√á√ÉO (ES6+) -->
    <script>
        // --- DADOS (Simula√ß√£o de Banco de Dados) ---
        const DB = [
            { id: 1, cat: "Alimentos", nome: "Arroz 5kg", preco: 25.00, img: "img/arroz.png" },
            { id: 2, cat: "Alimentos", nome: "A√ß√∫car Cristal 2kg", preco: 9.50, img: "img/acucar.png" },
            { id: 3, cat: "Alimentos", nome: "√ìleo de Soja 900ml", preco: 6.00, img: "img/oleo.png" },
            { id: 4, cat: "Alimentos", nome: "Feij√£o 1kg", preco: 8.50, img: "img/feijao.png" },
            { id: 5, cat: "Alimentos", nome: "Caf√© 500g", preco: 18.00, img: "img/cafe.png" },
            { id: 6, cat: "Alimentos", nome: "Macarr√£o 500g", preco: 4.50, img: "img/macarrao.png" },
            { id: 7, cat: "Alimentos", nome: "Ovos (D√∫zia)", preco: 12.00, img: "img/ovos.png" },
            { id: 8, cat: "Alimentos", nome: "Trigo 1kg", preco: 5.50, img: "img/trigo.png" },
            { id: 9, cat: "Alimentos", nome: "Sal 1kg", preco: 2.00, img: "img/sal.png" },
            { id: 10, cat: "Alimentos", nome: "Molho Tomate", preco: 3.00, img: "img/molho.png" },
            { id: 17, cat: "Limpeza", nome: "Sab√£o Barra Ype", preco: 11.00, img: "img/sabao_barra.png" },
            { id: 18, cat: "Limpeza", nome: "Creme Dental", preco: 4.50, img: "img/creme.png" },
            { id: 19, cat: "Limpeza", nome: "Papel Higi√™nico", preco: 6.00, img: "img/papel.png" },
            { id: 22, cat: "Limpeza", nome: "Sab√£o P√≥ OMO", preco: 13.00, img: "img/sabao_po.png" },
            { id: 23, cat: "Limpeza", nome: "Detergente Ype", preco: 2.50, img: "img/detergente.png" }
        ];

        // --- APLICA√á√ÉO ---
        const App = {
            state: {
                cart: {}, // { id: quantidade }
                history: [],
                config: {
                    minDiff: 10,
                    minTotal: 20,
                    phone: "5565996813588"
                }
            },

            init() {
                this.storage.load();
                this.ui.renderProducts();
                this.update();
            },

            // --- L√≥gica de Neg√≥cios ---
            actions: {
                changeQty(id, delta) {
                    const current = App.state.cart[id] || 0;
                    const newQty = Math.max(0, current + delta);
                    
                    if (newQty === 0) delete App.state.cart[id];
                    else App.state.cart[id] = newQty;

                    // Feedback visual se adicionar
                    if (delta > 0) App.ui.toast(`+1 ${DB.find(p => p.id === id).nome}`);

                    App.update();
                },

                checkout() {
                    const stats = App.helpers.calculateStats();
                    if (!stats.valid) {
                        App.ui.toast("‚ö†Ô∏è Complete os requisitos m√≠nimos da cesta!", "error");
                        return;
                    }

                    // Salvar hist√≥rico
                    const order = {
                        date: new Date().toLocaleString('pt-BR'),
                        total: stats.totalPrice,
                        itemsCount: stats.totalItems,
                        cartSnapshot: { ...App.state.cart }
                    };
                    App.state.history.unshift(order);
                    if (App.state.history.length > 5) App.state.history.pop();
                    App.storage.save();

                    // Gerar mensagem WhatsApp
                    let msg = `*üõí Pedido Dona Ant√¥nia*\nüìÖ ${order.date}\n\n`;
                    DB.forEach(p => {
                        if (App.state.cart[p.id]) {
                            msg += `‚ñ™ ${App.state.cart[p.id]}x ${p.nome}\n`;
                        }
                    });
                    msg += `\n*üí∞ Total: ${App.helpers.formatMoney(stats.totalPrice)}*`;
                    msg += `\nüì¶ Itens: ${stats.totalItems}`;

                    window.open(`https://wa.me/${App.state.config.phone}?text=${encodeURIComponent(msg)}`, '_blank');
                },

                toggleHistory() {
                    const content = `
                        <div class="bg-gray-50 p-4 border-b flex justify-between items-center">
                            <h3 class="font-bold text-gray-700">Hist√≥rico de Pedidos</h3>
                            <button onclick="App.ui.closeModal()" class="text-gray-400 hover:text-red-500"><i class="fas fa-times"></i></button>
                        </div>
                        <div class="max-h-[60vh] overflow-y-auto p-4 space-y-3">
                            ${App.state.history.length === 0 ? '<p class="text-center text-gray-500 text-sm">Nenhum pedido anterior.</p>' : ''}
                            ${App.state.history.map((h, index) => `
                                <div onclick="App.actions.restoreCart(${index})" class="bg-white border border-gray-200 p-3 rounded-lg shadow-sm hover:border-brand-gold cursor-pointer transition-all">
                                    <div class="flex justify-between text-xs text-gray-500 mb-1">
                                        <span>${h.date}</span>
                                        <span class="font-bold text-green-600">${App.helpers.formatMoney(h.total)}</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">${h.itemsCount} itens</div>
                                    <div class="text-xs text-blue-500 mt-2">Toque para refazer</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    App.ui.openModal(content);
                },

                restoreCart(index) {
                    App.state.cart = { ...App.state.history[index].cartSnapshot };
                    App.update();
                    App.ui.closeModal();
                    App.ui.toast("Cesta restaurada com sucesso!");
                },
                
                openContact() {
                     window.open(`https://wa.me/${App.state.config.phone}`, '_blank');
                }
            },

            // --- Atualiza√ß√£o Central ---
            update() {
                // 1. Salvar
                this.storage.save();

                // 2. Atualizar Contadores nos Cards
                DB.forEach(p => {
                    const qty = this.state.cart[p.id] || 0;
                    const qtyEl = document.getElementById(`qty-${p.id}`);
                    const cardEl = document.getElementById(`card-${p.id}`);
                    
                    if(qtyEl) qtyEl.innerText = qty;
                    
                    // Highlight visual card selecionado
                    if (qty > 0) {
                        cardEl.classList.add('border-brand-gold', 'bg-yellow-50/50', 'ring-1', 'ring-brand-gold');
                        cardEl.classList.remove('border-gray-100', 'bg-white');
                    } else {
                        cardEl.classList.remove('border-brand-gold', 'bg-yellow-50/50', 'ring-1', 'ring-brand-gold');
                        cardEl.classList.add('border-gray-100', 'bg-white');
                    }
                });

                // 3. Calcular Estat√≠sticas
                const stats = this.helpers.calculateStats();

                // 4. Atualizar Barra Inferior
                document.getElementById('ui-total-price').innerText = this.helpers.formatMoney(stats.totalPrice);
                
                // Barras de Progresso
                const diffPct = Math.min((stats.diffItems / this.state.config.minDiff) * 100, 100);
                const totalPct = Math.min((stats.totalItems / this.state.config.minTotal) * 100, 100);

                const barDif = document.getElementById('ui-dif-bar');
                const barTotal = document.getElementById('ui-total-bar');
                
                barDif.style.width = `${diffPct}%`;
                barTotal.style.width = `${totalPct}%`;

                // Cores de status
                const setStatus = (bar, icon, countEl, current, target) => {
                    countEl.innerText = `${current}/${target}`;
                    if (current >= target) {
                        bar.classList.add('bg-green-500');
                        bar.classList.remove('bg-brand-gold');
                        icon.classList.add('text-green-500');
                        icon.classList.remove('text-gray-300');
                    } else {
                        bar.classList.add('bg-brand-gold');
                        bar.classList.remove('bg-green-500');
                        icon.classList.remove('text-green-500');
                        icon.classList.add('text-gray-300');
                    }
                };

                setStatus(barDif, document.getElementById('ui-dif-check'), document.getElementById('ui-dif-count'), stats.diffItems, this.state.config.minDiff);
                setStatus(barTotal, document.getElementById('ui-total-check'), document.getElementById('ui-total-count'), stats.totalItems, this.state.config.minTotal);

                // Bot√£o Encomendar
                const btn = document.getElementById('btn-encomendar');
                if (stats.valid) {
                    btn.disabled = false;
                    btn.classList.remove('bg-gray-300', 'text-gray-500');
                    btn.classList.add('bg-brand-whatsapp', 'text-white', 'shadow-lg', 'shadow-green-200');
                } else {
                    btn.disabled = true;
                    btn.classList.add('bg-gray-300', 'text-gray-500');
                    btn.classList.remove('bg-brand-whatsapp', 'text-white', 'shadow-lg', 'shadow-green-200');
                }
            },

            // --- UI Rendering ---
            ui: {
                renderProducts() {
                    const root = document.getElementById('app-root');
                    const categories = [...new Set(DB.map(p => p.cat))]; // Pega categorias unicas
                    
                    let html = '';
                    
                    categories.forEach(cat => {
                        const prods = DB.filter(p => p.cat === cat);
                        html += `
                            <section>
                                <div class="flex items-center gap-2 mb-4">
                                    <div class="h-6 w-1 bg-brand-gold rounded-full"></div>
                                    <h3 class="text-xl font-bold text-brand-dark uppercase tracking-tight">${cat}</h3>
                                </div>
                                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-4">
                                    ${prods.map(p => this.cardTemplate(p)).join('')}
                                </div>
                            </section>
                        `;
                    });
                    
                    root.innerHTML = html;
                },

                cardTemplate(p) {
                    // Fallback de imagem inteligente usando Placehold.co e FontAwesome como decorativo se falhar
                    return `
                    <div id="card-${p.id}" class="group relative bg-white rounded-2xl p-3 border border-gray-100 shadow-sm transition-all duration-200 hover:shadow-md flex flex-col justify-between h-full select-none">
                        <div class="relative w-full aspect-square bg-gray-50 rounded-xl mb-3 overflow-hidden flex items-center justify-center">
                            <img src="${p.img}" alt="${p.nome}" 
                                 class="product-img w-full h-full p-2 transition-transform duration-300 group-hover:scale-110"
                                 onerror="this.onerror=null; this.src='https://placehold.co/300x300/f3f4f6/cbd5e1?text=${encodeURIComponent(p.nome.split(' ')[0])}';">
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 text-sm leading-tight min-h-[2.5em] line-clamp-2">${p.nome}</h4>
                            <p class="text-brand-gold font-bold text-lg mt-1">${App.helpers.formatMoney(p.preco)}</p>
                        </div>

                        <div class="mt-3 bg-gray-100 rounded-full flex items-center justify-between p-1">
                            <button onclick="App.actions.changeQty(${p.id}, -1)" class="w-8 h-8 rounded-full bg-white shadow-sm text-brand-red font-bold active:scale-90 transition-transform">-</button>
                            <span id="qty-${p.id}" class="font-bold text-brand-dark w-6 text-center">0</span>
                            <button onclick="App.actions.changeQty(${p.id}, 1)" class="w-8 h-8 rounded-full bg-brand-dark text-white shadow-sm font-bold active:scale-90 transition-transform hover:bg-opacity-90">+</button>
                        </div>
                    </div>
                    `;
                },

                toast(msg, type = 'success') {
                    const container = document.getElementById('toast-container');
                    const el = document.createElement('div');
                    const bgClass = type === 'success' ? 'bg-brand-dark' : 'bg-brand-red';
                    
                    el.className = `${bgClass} text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 toast-anim mb-2 pointer-events-auto`;
                    el.innerHTML = `
                        <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'} text-brand-gold"></i>
                        <span class="font-medium text-sm">${msg}</span>
                    `;
                    
                    container.appendChild(el);
                    setTimeout(() => {
                        el.style.opacity = '0';
                        el.style.transform = 'translateY(100%)';
                        setTimeout(() => el.remove(), 300);
                    }, 2500);
                },

                openModal(htmlContent) {
                    const overlay = document.getElementById('modal-overlay');
                    const content = document.getElementById('modal-content');
                    content.innerHTML = htmlContent;
                    overlay.classList.remove('hidden');
                    // Timeout para permitir transi√ß√£o CSS
                    setTimeout(() => {
                        overlay.classList.remove('opacity-0');
                        content.classList.remove('scale-95');
                        content.classList.add('scale-100');
                    }, 10);
                },

                closeModal() {
                    const overlay = document.getElementById('modal-overlay');
                    const content = document.getElementById('modal-content');
                    overlay.classList.add('opacity-0');
                    content.classList.remove('scale-100');
                    content.classList.add('scale-95');
                    setTimeout(() => overlay.classList.add('hidden'), 300);
                }
            },

            // --- Helpers & Storage ---
            helpers: {
                formatMoney(val) { return val.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }); },
                calculateStats() {
                    let totalItems = 0;
                    let diffItems = 0;
                    let totalPrice = 0;

                    Object.entries(App.state.cart).forEach(([id, qty]) => {
                        const product = DB.find(p => p.id == id);
                        if (product && qty > 0) {
                            totalItems += qty;
                            diffItems++;
                            totalPrice += (product.preco * qty);
                        }
                    });

                    return {
                        totalItems,
                        diffItems,
                        totalPrice,
                        valid: diffItems >= App.state.config.minDiff && totalItems >= App.state.config.minTotal
                    };
                }
            },

            storage: {
                save() {
                    try {
                        localStorage.setItem('da_cart', JSON.stringify(App.state.cart));
                        localStorage.setItem('da_history', JSON.stringify(App.state.history));
                    } catch (e) { console.error("Erro localStorage", e); }
                },
                load() {
                    try {
                        const c = localStorage.getItem('da_cart');
                        const h = localStorage.getItem('da_history');
                        if (c) App.state.cart = JSON.parse(c);
                        if (h) App.state.history = JSON.parse(h);
                    } catch (e) { console.error("Erro localStorage", e); }
                }
            }
        };

        // Iniciar
        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>
